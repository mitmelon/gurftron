!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var r=e();for(var n in r)("object"==typeof exports?exports:t)[n]=r[n]}}(this,()=>(()=>{"use strict";var t={9306:(t,e,r)=>{var n=r(4901),i=r(6823),o=TypeError;t.exports=function(t){if(n(t))return t;throw new o(i(t)+" is not a function")}},3506:(t,e,r)=>{var n=r(3925),i=String,o=TypeError;t.exports=function(t){if(n(t))return t;throw new o("Can't set "+i(t)+" as a prototype")}},7080:(t,e,r)=>{var n=r(4402).has;t.exports=function(t){return n(t),t}},3463:t=>{var e=TypeError;t.exports=function(t){if("string"==typeof t)return t;throw new e("Argument is not a string")}},679:(t,e,r)=>{var n=r(1625),i=TypeError;t.exports=function(t,e){if(n(e,t))return t;throw new i("Incorrect invocation")}},3972:(t,e,r)=>{var n=r(34),i=String,o=TypeError;t.exports=function(t){if(void 0===t||n(t))return t;throw new o(i(t)+" is not an object or undefined")}},8551:(t,e,r)=>{var n=r(34),i=String,o=TypeError;t.exports=function(t){if(n(t))return t;throw new o(i(t)+" is not an object")}},4154:(t,e,r)=>{var n=r(6955),i=TypeError;t.exports=function(t){if("Uint8Array"===n(t))return t;throw new i("Argument is not an Uint8Array")}},7811:t=>{t.exports="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView},7394:(t,e,r)=>{var n=r(4576),i=r(6706),o=r(2195),a=n.ArrayBuffer,s=n.TypeError;t.exports=a&&i(a.prototype,"byteLength","get")||function(t){if("ArrayBuffer"!==o(t))throw new s("ArrayBuffer expected");return t.byteLength}},3238:(t,e,r)=>{var n=r(4576),i=r(7476),o=r(7394),a=n.ArrayBuffer,s=a&&a.prototype,c=s&&i(s.slice);t.exports=function(t){if(0!==o(t))return!1;if(!c)return!1;try{return c(t,0,0),!1}catch(t){return!0}}},5169:(t,e,r)=>{var n=r(3238),i=TypeError;t.exports=function(t){if(n(t))throw new i("ArrayBuffer is detached");return t}},5636:(t,e,r)=>{var n=r(4576),i=r(9504),o=r(6706),a=r(7696),s=r(5169),c=r(7394),l=r(4483),u=r(1548),h=n.structuredClone,d=n.ArrayBuffer,f=n.DataView,g=Math.min,p=d.prototype,y=f.prototype,m=i(p.slice),v=o(p,"resizable","get"),w=o(p,"maxByteLength","get"),b=i(y.getInt8),S=i(y.setInt8);t.exports=(u||l)&&function(t,e,r){var n,i=c(t),o=void 0===e?i:a(e),p=!v||!v(t);if(s(t),u&&(t=h(t,{transfer:[t]}),i===o&&(r||p)))return t;if(i>=o&&(!r||p))n=m(t,0,o);else{var y=r&&!p&&w?{maxByteLength:w(t)}:void 0;n=new d(o,y);for(var E=new f(t),T=new f(n),I=g(o,i),x=0;x<I;x++)S(T,x,b(E,x))}return u||l(t),n}},4644:(t,e,r)=>{var n,i,o,a=r(7811),s=r(3724),c=r(4576),l=r(4901),u=r(34),h=r(9297),d=r(6955),f=r(6823),g=r(6699),p=r(6840),y=r(2106),m=r(1625),v=r(2787),w=r(2967),b=r(8227),S=r(3392),E=r(1181),T=E.enforce,I=E.get,x=c.Int8Array,A=x&&x.prototype,k=c.Uint8ClampedArray,R=k&&k.prototype,O=x&&v(x),_=A&&v(A),M=Object.prototype,C=c.TypeError,N=b("toStringTag"),L=S("TYPED_ARRAY_TAG"),D="TypedArrayConstructor",P=a&&!!w&&"Opera"!==d(c.opera),j=!1,U={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},F={BigInt64Array:8,BigUint64Array:8},$=function(t){var e=v(t);if(u(e)){var r=I(e);return r&&h(r,D)?r[D]:$(e)}},B=function(t){if(!u(t))return!1;var e=d(t);return h(U,e)||h(F,e)};for(n in U)(o=(i=c[n])&&i.prototype)?T(o)[D]=i:P=!1;for(n in F)(o=(i=c[n])&&i.prototype)&&(T(o)[D]=i);if((!P||!l(O)||O===Function.prototype)&&(O=function(){throw new C("Incorrect invocation")},P))for(n in U)c[n]&&w(c[n],O);if((!P||!_||_===M)&&(_=O.prototype,P))for(n in U)c[n]&&w(c[n].prototype,_);if(P&&v(R)!==_&&w(R,_),s&&!h(_,N))for(n in j=!0,y(_,N,{configurable:!0,get:function(){return u(this)?this[L]:void 0}}),U)c[n]&&g(c[n],L,n);t.exports={NATIVE_ARRAY_BUFFER_VIEWS:P,TYPED_ARRAY_TAG:j&&L,aTypedArray:function(t){if(B(t))return t;throw new C("Target is not a typed array")},aTypedArrayConstructor:function(t){if(l(t)&&(!w||m(O,t)))return t;throw new C(f(t)+" is not a typed array constructor")},exportTypedArrayMethod:function(t,e,r,n){if(s){if(r)for(var i in U){var o=c[i];if(o&&h(o.prototype,t))try{delete o.prototype[t]}catch(r){try{o.prototype[t]=e}catch(t){}}}_[t]&&!r||p(_,t,r?e:P&&A[t]||e,n)}},exportTypedArrayStaticMethod:function(t,e,r){var n,i;if(s){if(w){if(r)for(n in U)if((i=c[n])&&h(i,t))try{delete i[t]}catch(t){}if(O[t]&&!r)return;try{return p(O,t,r?e:P&&O[t]||e)}catch(t){}}for(n in U)!(i=c[n])||i[t]&&!r||p(i,t,e)}},getTypedArrayConstructor:$,isView:function(t){if(!u(t))return!1;var e=d(t);return"DataView"===e||h(U,e)||h(F,e)},isTypedArray:B,TypedArray:O,TypedArrayPrototype:_}},5370:(t,e,r)=>{var n=r(6198);t.exports=function(t,e,r){for(var i=0,o=arguments.length>2?r:n(e),a=new t(o);o>i;)a[i]=e[i++];return a}},9617:(t,e,r)=>{var n=r(5397),i=r(5610),o=r(6198),a=function(t){return function(e,r,a){var s=n(e),c=o(s);if(0===c)return!t&&-1;var l,u=i(a,c);if(t&&r!=r){for(;c>u;)if((l=s[u++])!=l)return!0}else for(;c>u;u++)if((t||u in s)&&s[u]===r)return t||u||0;return!t&&-1}};t.exports={includes:a(!0),indexOf:a(!1)}},3839:(t,e,r)=>{var n=r(6080),i=r(7055),o=r(8981),a=r(6198),s=function(t){var e=1===t;return function(r,s,c){for(var l,u=o(r),h=i(u),d=a(h),f=n(s,c);d-- >0;)if(f(l=h[d],d,u))switch(t){case 0:return l;case 1:return d}return e?-1:void 0}};t.exports={findLast:s(0),findLastIndex:s(1)}},4527:(t,e,r)=>{var n=r(3724),i=r(4376),o=TypeError,a=Object.getOwnPropertyDescriptor,s=n&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(t){return t instanceof TypeError}}();t.exports=s?function(t,e){if(i(t)&&!a(t,"length").writable)throw new o("Cannot set read only .length");return t.length=e}:function(t,e){return t.length=e}},7628:(t,e,r)=>{var n=r(6198);t.exports=function(t,e){for(var r=n(t),i=new e(r),o=0;o<r;o++)i[o]=t[r-o-1];return i}},9928:(t,e,r)=>{var n=r(6198),i=r(1291),o=RangeError;t.exports=function(t,e,r,a){var s=n(t),c=i(r),l=c<0?s+c:c;if(l>=s||l<0)throw new o("Incorrect index");for(var u=new e(s),h=0;h<s;h++)u[h]=h===l?a:t[h];return u}},2804:t=>{var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=e+"+/",n=e+"-_",i=function(t){for(var e={},r=0;r<64;r++)e[t.charAt(r)]=r;return e};t.exports={i2c:r,c2i:i(r),i2cUrl:n,c2iUrl:i(n)}},6319:(t,e,r)=>{var n=r(8551),i=r(9539);t.exports=function(t,e,r,o){try{return o?e(n(r)[0],r[1]):e(r)}catch(e){i(t,"throw",e)}}},2195:(t,e,r)=>{var n=r(9504),i=n({}.toString),o=n("".slice);t.exports=function(t){return o(i(t),8,-1)}},6955:(t,e,r)=>{var n=r(2140),i=r(4901),o=r(2195),a=r(8227)("toStringTag"),s=Object,c="Arguments"===o(function(){return arguments}());t.exports=n?o:function(t){var e,r,n;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(r=function(t,e){try{return t[e]}catch(t){}}(e=s(t),a))?r:c?o(e):"Object"===(n=o(e))&&i(e.callee)?"Arguments":n}},7740:(t,e,r)=>{var n=r(9297),i=r(5031),o=r(7347),a=r(4913);t.exports=function(t,e,r){for(var s=i(e),c=a.f,l=o.f,u=0;u<s.length;u++){var h=s[u];n(t,h)||r&&n(r,h)||c(t,h,l(e,h))}}},2211:(t,e,r)=>{var n=r(9039);t.exports=!n(function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype})},2529:t=>{t.exports=function(t,e){return{value:t,done:e}}},6699:(t,e,r)=>{var n=r(3724),i=r(4913),o=r(6980);t.exports=n?function(t,e,r){return i.f(t,e,o(1,r))}:function(t,e,r){return t[e]=r,t}},6980:t=>{t.exports=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}},4659:(t,e,r)=>{var n=r(3724),i=r(4913),o=r(6980);t.exports=function(t,e,r){n?i.f(t,e,o(0,r)):t[e]=r}},2106:(t,e,r)=>{var n=r(283),i=r(4913);t.exports=function(t,e,r){return r.get&&n(r.get,e,{getter:!0}),r.set&&n(r.set,e,{setter:!0}),i.f(t,e,r)}},6840:(t,e,r)=>{var n=r(4901),i=r(4913),o=r(283),a=r(9433);t.exports=function(t,e,r,s){s||(s={});var c=s.enumerable,l=void 0!==s.name?s.name:e;if(n(r)&&o(r,l,s),s.global)c?t[e]=r:a(e,r);else{try{s.unsafe?t[e]&&(c=!0):delete t[e]}catch(t){}c?t[e]=r:i.f(t,e,{value:r,enumerable:!1,configurable:!s.nonConfigurable,writable:!s.nonWritable})}return t}},6279:(t,e,r)=>{var n=r(6840);t.exports=function(t,e,r){for(var i in e)n(t,i,e[i],r);return t}},9433:(t,e,r)=>{var n=r(4576),i=Object.defineProperty;t.exports=function(t,e){try{i(n,t,{value:e,configurable:!0,writable:!0})}catch(r){n[t]=e}return e}},3724:(t,e,r)=>{var n=r(9039);t.exports=!n(function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]})},4483:(t,e,r)=>{var n,i,o,a,s=r(4576),c=r(9429),l=r(1548),u=s.structuredClone,h=s.ArrayBuffer,d=s.MessageChannel,f=!1;if(l)f=function(t){u(t,{transfer:[t]})};else if(h)try{d||(n=c("worker_threads"))&&(d=n.MessageChannel),d&&(i=new d,o=new h(2),a=function(t){i.port1.postMessage(null,[t])},2===o.byteLength&&(a(o),0===o.byteLength&&(f=a)))}catch(t){}t.exports=f},4055:(t,e,r)=>{var n=r(4576),i=r(34),o=n.document,a=i(o)&&i(o.createElement);t.exports=function(t){return a?o.createElement(t):{}}},6837:t=>{var e=TypeError;t.exports=function(t){if(t>9007199254740991)throw e("Maximum allowed index exceeded");return t}},5002:t=>{t.exports={IndexSizeError:{s:"INDEX_SIZE_ERR",c:1,m:1},DOMStringSizeError:{s:"DOMSTRING_SIZE_ERR",c:2,m:0},HierarchyRequestError:{s:"HIERARCHY_REQUEST_ERR",c:3,m:1},WrongDocumentError:{s:"WRONG_DOCUMENT_ERR",c:4,m:1},InvalidCharacterError:{s:"INVALID_CHARACTER_ERR",c:5,m:1},NoDataAllowedError:{s:"NO_DATA_ALLOWED_ERR",c:6,m:0},NoModificationAllowedError:{s:"NO_MODIFICATION_ALLOWED_ERR",c:7,m:1},NotFoundError:{s:"NOT_FOUND_ERR",c:8,m:1},NotSupportedError:{s:"NOT_SUPPORTED_ERR",c:9,m:1},InUseAttributeError:{s:"INUSE_ATTRIBUTE_ERR",c:10,m:1},InvalidStateError:{s:"INVALID_STATE_ERR",c:11,m:1},SyntaxError:{s:"SYNTAX_ERR",c:12,m:1},InvalidModificationError:{s:"INVALID_MODIFICATION_ERR",c:13,m:1},NamespaceError:{s:"NAMESPACE_ERR",c:14,m:1},InvalidAccessError:{s:"INVALID_ACCESS_ERR",c:15,m:1},ValidationError:{s:"VALIDATION_ERR",c:16,m:0},TypeMismatchError:{s:"TYPE_MISMATCH_ERR",c:17,m:1},SecurityError:{s:"SECURITY_ERR",c:18,m:1},NetworkError:{s:"NETWORK_ERR",c:19,m:1},AbortError:{s:"ABORT_ERR",c:20,m:1},URLMismatchError:{s:"URL_MISMATCH_ERR",c:21,m:1},QuotaExceededError:{s:"QUOTA_EXCEEDED_ERR",c:22,m:1},TimeoutError:{s:"TIMEOUT_ERR",c:23,m:1},InvalidNodeTypeError:{s:"INVALID_NODE_TYPE_ERR",c:24,m:1},DataCloneError:{s:"DATA_CLONE_ERR",c:25,m:1}}},8727:t=>{t.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},8574:(t,e,r)=>{var n=r(4215);t.exports="NODE"===n},2839:(t,e,r)=>{var n=r(4576).navigator,i=n&&n.userAgent;t.exports=i?String(i):""},9519:(t,e,r)=>{var n,i,o=r(4576),a=r(2839),s=o.process,c=o.Deno,l=s&&s.versions||c&&c.version,u=l&&l.v8;u&&(i=(n=u.split("."))[0]>0&&n[0]<4?1:+(n[0]+n[1])),!i&&a&&(!(n=a.match(/Edge\/(\d+)/))||n[1]>=74)&&(n=a.match(/Chrome\/(\d+)/))&&(i=+n[1]),t.exports=i},4215:(t,e,r)=>{var n=r(4576),i=r(2839),o=r(2195),a=function(t){return i.slice(0,t.length)===t};t.exports=a("Bun/")?"BUN":a("Cloudflare-Workers")?"CLOUDFLARE":a("Deno/")?"DENO":a("Node.js/")?"NODE":n.Bun&&"string"==typeof Bun.version?"BUN":n.Deno&&"object"==typeof Deno.version?"DENO":"process"===o(n.process)?"NODE":n.window&&n.document?"BROWSER":"REST"},6193:(t,e,r)=>{var n=r(9504),i=Error,o=n("".replace),a=String(new i("zxcasd").stack),s=/\n\s*at [^:]*:[^\n]*/,c=s.test(a);t.exports=function(t,e){if(c&&"string"==typeof t&&!i.prepareStackTrace)for(;e--;)t=o(t,s,"");return t}},747:(t,e,r)=>{var n=r(6699),i=r(6193),o=r(6249),a=Error.captureStackTrace;t.exports=function(t,e,r,s){o&&(a?a(t,e):n(t,"stack",i(r,s)))}},6249:(t,e,r)=>{var n=r(9039),i=r(6980);t.exports=!n(function(){var t=new Error("a");return!("stack"in t)||(Object.defineProperty(t,"stack",i(1,7)),7!==t.stack)})},6518:(t,e,r)=>{var n=r(4576),i=r(7347).f,o=r(6699),a=r(6840),s=r(9433),c=r(7740),l=r(2796);t.exports=function(t,e){var r,u,h,d,f,g=t.target,p=t.global,y=t.stat;if(r=p?n:y?n[g]||s(g,{}):n[g]&&n[g].prototype)for(u in e){if(d=e[u],h=t.dontCallGetSet?(f=i(r,u))&&f.value:r[u],!l(p?u:g+(y?".":"#")+u,t.forced)&&void 0!==h){if(typeof d==typeof h)continue;c(d,h)}(t.sham||h&&h.sham)&&o(d,"sham",!0),a(r,u,d,t)}}},9039:t=>{t.exports=function(t){try{return!!t()}catch(t){return!0}}},8745:(t,e,r)=>{var n=r(616),i=Function.prototype,o=i.apply,a=i.call;t.exports="object"==typeof Reflect&&Reflect.apply||(n?a.bind(o):function(){return a.apply(o,arguments)})},6080:(t,e,r)=>{var n=r(7476),i=r(9306),o=r(616),a=n(n.bind);t.exports=function(t,e){return i(t),void 0===e?t:o?a(t,e):function(){return t.apply(e,arguments)}}},616:(t,e,r)=>{var n=r(9039);t.exports=!n(function(){var t=function(){}.bind();return"function"!=typeof t||t.hasOwnProperty("prototype")})},9565:(t,e,r)=>{var n=r(616),i=Function.prototype.call;t.exports=n?i.bind(i):function(){return i.apply(i,arguments)}},350:(t,e,r)=>{var n=r(3724),i=r(9297),o=Function.prototype,a=n&&Object.getOwnPropertyDescriptor,s=i(o,"name"),c=s&&"something"===function(){}.name,l=s&&(!n||n&&a(o,"name").configurable);t.exports={EXISTS:s,PROPER:c,CONFIGURABLE:l}},6706:(t,e,r)=>{var n=r(9504),i=r(9306);t.exports=function(t,e,r){try{return n(i(Object.getOwnPropertyDescriptor(t,e)[r]))}catch(t){}}},7476:(t,e,r)=>{var n=r(2195),i=r(9504);t.exports=function(t){if("Function"===n(t))return i(t)}},9504:(t,e,r)=>{var n=r(616),i=Function.prototype,o=i.call,a=n&&i.bind.bind(o,o);t.exports=n?a:function(t){return function(){return o.apply(t,arguments)}}},944:t=>{var e=TypeError;t.exports=function(t){var r=t&&t.alphabet;if(void 0===r||"base64"===r||"base64url"===r)return r||"base64";throw new e("Incorrect `alphabet` option")}},9429:(t,e,r)=>{var n=r(4576),i=r(8574);t.exports=function(t){if(i){try{return n.process.getBuiltinModule(t)}catch(t){}try{return Function('return require("'+t+'")')()}catch(t){}}}},7751:(t,e,r)=>{var n=r(4576),i=r(4901);t.exports=function(t,e){return arguments.length<2?(r=n[t],i(r)?r:void 0):n[t]&&n[t][e];var r}},1767:t=>{t.exports=function(t){return{iterator:t,next:t.next,done:!1}}},851:(t,e,r)=>{var n=r(6955),i=r(5966),o=r(4117),a=r(6269),s=r(8227)("iterator");t.exports=function(t){if(!o(t))return i(t,s)||i(t,"@@iterator")||a[n(t)]}},81:(t,e,r)=>{var n=r(9565),i=r(9306),o=r(8551),a=r(6823),s=r(851),c=TypeError;t.exports=function(t,e){var r=arguments.length<2?s(t):e;if(i(r))return o(n(r,t));throw new c(a(t)+" is not iterable")}},5966:(t,e,r)=>{var n=r(9306),i=r(4117);t.exports=function(t,e){var r=t[e];return i(r)?void 0:n(r)}},3789:(t,e,r)=>{var n=r(9306),i=r(8551),o=r(9565),a=r(1291),s=r(1767),c="Invalid size",l=RangeError,u=TypeError,h=Math.max,d=function(t,e){this.set=t,this.size=h(e,0),this.has=n(t.has),this.keys=n(t.keys)};d.prototype={getIterator:function(){return s(i(o(this.keys,this.set)))},includes:function(t){return o(this.has,this.set,t)}},t.exports=function(t){i(t);var e=+t.size;if(e!=e)throw new u(c);var r=a(e);if(r<0)throw new l(c);return new d(t,r)}},4576:function(t,e,r){var n=function(t){return t&&t.Math===Math&&t};t.exports=n("object"==typeof globalThis&&globalThis)||n("object"==typeof window&&window)||n("object"==typeof self&&self)||n("object"==typeof r.g&&r.g)||n("object"==typeof this&&this)||function(){return this}()||Function("return this")()},9297:(t,e,r)=>{var n=r(9504),i=r(8981),o=n({}.hasOwnProperty);t.exports=Object.hasOwn||function(t,e){return o(i(t),e)}},421:t=>{t.exports={}},397:(t,e,r)=>{var n=r(7751);t.exports=n("document","documentElement")},5917:(t,e,r)=>{var n=r(3724),i=r(9039),o=r(4055);t.exports=!n&&!i(function(){return 7!==Object.defineProperty(o("div"),"a",{get:function(){return 7}}).a})},7055:(t,e,r)=>{var n=r(9504),i=r(9039),o=r(2195),a=Object,s=n("".split);t.exports=i(function(){return!a("z").propertyIsEnumerable(0)})?function(t){return"String"===o(t)?s(t,""):a(t)}:a},3167:(t,e,r)=>{var n=r(4901),i=r(34),o=r(2967);t.exports=function(t,e,r){var a,s;return o&&n(a=e.constructor)&&a!==r&&i(s=a.prototype)&&s!==r.prototype&&o(t,s),t}},3706:(t,e,r)=>{var n=r(9504),i=r(4901),o=r(7629),a=n(Function.toString);i(o.inspectSource)||(o.inspectSource=function(t){return a(t)}),t.exports=o.inspectSource},7584:(t,e,r)=>{var n=r(34),i=r(6699);t.exports=function(t,e){n(e)&&"cause"in e&&i(t,"cause",e.cause)}},1181:(t,e,r)=>{var n,i,o,a=r(8622),s=r(4576),c=r(34),l=r(6699),u=r(9297),h=r(7629),d=r(6119),f=r(421),g="Object already initialized",p=s.TypeError,y=s.WeakMap;if(a||h.state){var m=h.state||(h.state=new y);m.get=m.get,m.has=m.has,m.set=m.set,n=function(t,e){if(m.has(t))throw new p(g);return e.facade=t,m.set(t,e),e},i=function(t){return m.get(t)||{}},o=function(t){return m.has(t)}}else{var v=d("state");f[v]=!0,n=function(t,e){if(u(t,v))throw new p(g);return e.facade=t,l(t,v,e),e},i=function(t){return u(t,v)?t[v]:{}},o=function(t){return u(t,v)}}t.exports={set:n,get:i,has:o,enforce:function(t){return o(t)?i(t):n(t,{})},getterFor:function(t){return function(e){var r;if(!c(e)||(r=i(e)).type!==t)throw new p("Incompatible receiver, "+t+" required");return r}}}},4209:(t,e,r)=>{var n=r(8227),i=r(6269),o=n("iterator"),a=Array.prototype;t.exports=function(t){return void 0!==t&&(i.Array===t||a[o]===t)}},4376:(t,e,r)=>{var n=r(2195);t.exports=Array.isArray||function(t){return"Array"===n(t)}},1108:(t,e,r)=>{var n=r(6955);t.exports=function(t){var e=n(t);return"BigInt64Array"===e||"BigUint64Array"===e}},4901:t=>{var e="object"==typeof document&&document.all;t.exports=void 0===e&&void 0!==e?function(t){return"function"==typeof t||t===e}:function(t){return"function"==typeof t}},2796:(t,e,r)=>{var n=r(9039),i=r(4901),o=/#|\.prototype\./,a=function(t,e){var r=c[s(t)];return r===u||r!==l&&(i(e)?n(e):!!e)},s=a.normalize=function(t){return String(t).replace(o,".").toLowerCase()},c=a.data={},l=a.NATIVE="N",u=a.POLYFILL="P";t.exports=a},4117:t=>{t.exports=function(t){return null==t}},34:(t,e,r)=>{var n=r(4901);t.exports=function(t){return"object"==typeof t?null!==t:n(t)}},3925:(t,e,r)=>{var n=r(34);t.exports=function(t){return n(t)||null===t}},6395:t=>{t.exports=!1},757:(t,e,r)=>{var n=r(7751),i=r(4901),o=r(1625),a=r(7040),s=Object;t.exports=a?function(t){return"symbol"==typeof t}:function(t){var e=n("Symbol");return i(e)&&o(e.prototype,s(t))}},507:(t,e,r)=>{var n=r(9565);t.exports=function(t,e,r){for(var i,o,a=r?t:t.iterator,s=t.next;!(i=n(s,a)).done;)if(void 0!==(o=e(i.value)))return o}},2652:(t,e,r)=>{var n=r(6080),i=r(9565),o=r(8551),a=r(6823),s=r(4209),c=r(6198),l=r(1625),u=r(81),h=r(851),d=r(9539),f=TypeError,g=function(t,e){this.stopped=t,this.result=e},p=g.prototype;t.exports=function(t,e,r){var y,m,v,w,b,S,E,T=r&&r.that,I=!(!r||!r.AS_ENTRIES),x=!(!r||!r.IS_RECORD),A=!(!r||!r.IS_ITERATOR),k=!(!r||!r.INTERRUPTED),R=n(e,T),O=function(t){return y&&d(y,"normal",t),new g(!0,t)},_=function(t){return I?(o(t),k?R(t[0],t[1],O):R(t[0],t[1])):k?R(t,O):R(t)};if(x)y=t.iterator;else if(A)y=t;else{if(!(m=h(t)))throw new f(a(t)+" is not iterable");if(s(m)){for(v=0,w=c(t);w>v;v++)if((b=_(t[v]))&&l(p,b))return b;return new g(!1)}y=u(t,m)}for(S=x?t.next:y.next;!(E=i(S,y)).done;){try{b=_(E.value)}catch(t){d(y,"throw",t)}if("object"==typeof b&&b&&l(p,b))return b}return new g(!1)}},9539:(t,e,r)=>{var n=r(9565),i=r(8551),o=r(5966);t.exports=function(t,e,r){var a,s;i(t);try{if(!(a=o(t,"return"))){if("throw"===e)throw r;return r}a=n(a,t)}catch(t){s=!0,a=t}if("throw"===e)throw r;if(s)throw a;return i(a),r}},9462:(t,e,r)=>{var n=r(9565),i=r(2360),o=r(6699),a=r(6279),s=r(8227),c=r(1181),l=r(5966),u=r(7657).IteratorPrototype,h=r(2529),d=r(9539),f=s("toStringTag"),g="IteratorHelper",p="WrapForValidIterator",y=c.set,m=function(t){var e=c.getterFor(t?p:g);return a(i(u),{next:function(){var r=e(this);if(t)return r.nextHandler();try{var n=r.done?void 0:r.nextHandler();return h(n,r.done)}catch(t){throw r.done=!0,t}},return:function(){var r=e(this),i=r.iterator;if(r.done=!0,t){var o=l(i,"return");return o?n(o,i):h(void 0,!0)}if(r.inner)try{d(r.inner.iterator,"normal")}catch(t){return d(i,"throw",t)}return d(i,"normal"),h(void 0,!0)}})},v=m(!0),w=m(!1);o(w,f,"Iterator Helper"),t.exports=function(t,e){var r=function(r,n){n?(n.iterator=r.iterator,n.next=r.next):n=r,n.type=e?p:g,n.nextHandler=t,n.counter=0,n.done=!1,y(this,n)};return r.prototype=e?v:w,r}},713:(t,e,r)=>{var n=r(9565),i=r(9306),o=r(8551),a=r(1767),s=r(9462),c=r(6319),l=s(function(){var t=this.iterator,e=o(n(this.next,t));if(!(this.done=!!e.done))return c(t,this.mapper,[e.value,this.counter++],!0)});t.exports=function(t){return o(this),i(t),new l(a(this),{mapper:t})}},7657:(t,e,r)=>{var n,i,o,a=r(9039),s=r(4901),c=r(34),l=r(2360),u=r(2787),h=r(6840),d=r(8227),f=r(6395),g=d("iterator"),p=!1;[].keys&&("next"in(o=[].keys())?(i=u(u(o)))!==Object.prototype&&(n=i):p=!0),!c(n)||a(function(){var t={};return n[g].call(t)!==t})?n={}:f&&(n=l(n)),s(n[g])||h(n,g,function(){return this}),t.exports={IteratorPrototype:n,BUGGY_SAFARI_ITERATORS:p}},6269:t=>{t.exports={}},6198:(t,e,r)=>{var n=r(8014);t.exports=function(t){return n(t.length)}},283:(t,e,r)=>{var n=r(9504),i=r(9039),o=r(4901),a=r(9297),s=r(3724),c=r(350).CONFIGURABLE,l=r(3706),u=r(1181),h=u.enforce,d=u.get,f=String,g=Object.defineProperty,p=n("".slice),y=n("".replace),m=n([].join),v=s&&!i(function(){return 8!==g(function(){},"length",{value:8}).length}),w=String(String).split("String"),b=t.exports=function(t,e,r){"Symbol("===p(f(e),0,7)&&(e="["+y(f(e),/^Symbol\(([^)]*)\).*$/,"$1")+"]"),r&&r.getter&&(e="get "+e),r&&r.setter&&(e="set "+e),(!a(t,"name")||c&&t.name!==e)&&(s?g(t,"name",{value:e,configurable:!0}):t.name=e),v&&r&&a(r,"arity")&&t.length!==r.arity&&g(t,"length",{value:r.arity});try{r&&a(r,"constructor")&&r.constructor?s&&g(t,"prototype",{writable:!1}):t.prototype&&(t.prototype=void 0)}catch(t){}var n=h(t);return a(n,"source")||(n.source=m(w,"string"==typeof e?e:"")),t};Function.prototype.toString=b(function(){return o(this)&&d(this).source||l(this)},"toString")},741:t=>{var e=Math.ceil,r=Math.floor;t.exports=Math.trunc||function(t){var n=+t;return(n>0?r:e)(n)}},2603:(t,e,r)=>{var n=r(655);t.exports=function(t,e){return void 0===t?arguments.length<2?"":e:n(t)}},2360:(t,e,r)=>{var n,i=r(8551),o=r(6801),a=r(8727),s=r(421),c=r(397),l=r(4055),u=r(6119),h="prototype",d="script",f=u("IE_PROTO"),g=function(){},p=function(t){return"<"+d+">"+t+"</"+d+">"},y=function(t){t.write(p("")),t.close();var e=t.parentWindow.Object;return t=null,e},m=function(){try{n=new ActiveXObject("htmlfile")}catch(t){}var t,e,r;m="undefined"!=typeof document?document.domain&&n?y(n):(e=l("iframe"),r="java"+d+":",e.style.display="none",c.appendChild(e),e.src=String(r),(t=e.contentWindow.document).open(),t.write(p("document.F=Object")),t.close(),t.F):y(n);for(var i=a.length;i--;)delete m[h][a[i]];return m()};s[f]=!0,t.exports=Object.create||function(t,e){var r;return null!==t?(g[h]=i(t),r=new g,g[h]=null,r[f]=t):r=m(),void 0===e?r:o.f(r,e)}},6801:(t,e,r)=>{var n=r(3724),i=r(8686),o=r(4913),a=r(8551),s=r(5397),c=r(1072);e.f=n&&!i?Object.defineProperties:function(t,e){a(t);for(var r,n=s(e),i=c(e),l=i.length,u=0;l>u;)o.f(t,r=i[u++],n[r]);return t}},4913:(t,e,r)=>{var n=r(3724),i=r(5917),o=r(8686),a=r(8551),s=r(6969),c=TypeError,l=Object.defineProperty,u=Object.getOwnPropertyDescriptor,h="enumerable",d="configurable",f="writable";e.f=n?o?function(t,e,r){if(a(t),e=s(e),a(r),"function"==typeof t&&"prototype"===e&&"value"in r&&f in r&&!r[f]){var n=u(t,e);n&&n[f]&&(t[e]=r.value,r={configurable:d in r?r[d]:n[d],enumerable:h in r?r[h]:n[h],writable:!1})}return l(t,e,r)}:l:function(t,e,r){if(a(t),e=s(e),a(r),i)try{return l(t,e,r)}catch(t){}if("get"in r||"set"in r)throw new c("Accessors not supported");return"value"in r&&(t[e]=r.value),t}},7347:(t,e,r)=>{var n=r(3724),i=r(9565),o=r(8773),a=r(6980),s=r(5397),c=r(6969),l=r(9297),u=r(5917),h=Object.getOwnPropertyDescriptor;e.f=n?h:function(t,e){if(t=s(t),e=c(e),u)try{return h(t,e)}catch(t){}if(l(t,e))return a(!i(o.f,t,e),t[e])}},8480:(t,e,r)=>{var n=r(1828),i=r(8727).concat("length","prototype");e.f=Object.getOwnPropertyNames||function(t){return n(t,i)}},3717:(t,e)=>{e.f=Object.getOwnPropertySymbols},2787:(t,e,r)=>{var n=r(9297),i=r(4901),o=r(8981),a=r(6119),s=r(2211),c=a("IE_PROTO"),l=Object,u=l.prototype;t.exports=s?l.getPrototypeOf:function(t){var e=o(t);if(n(e,c))return e[c];var r=e.constructor;return i(r)&&e instanceof r?r.prototype:e instanceof l?u:null}},1625:(t,e,r)=>{var n=r(9504);t.exports=n({}.isPrototypeOf)},1828:(t,e,r)=>{var n=r(9504),i=r(9297),o=r(5397),a=r(9617).indexOf,s=r(421),c=n([].push);t.exports=function(t,e){var r,n=o(t),l=0,u=[];for(r in n)!i(s,r)&&i(n,r)&&c(u,r);for(;e.length>l;)i(n,r=e[l++])&&(~a(u,r)||c(u,r));return u}},1072:(t,e,r)=>{var n=r(1828),i=r(8727);t.exports=Object.keys||function(t){return n(t,i)}},8773:(t,e)=>{var r={}.propertyIsEnumerable,n=Object.getOwnPropertyDescriptor,i=n&&!r.call({1:2},1);e.f=i?function(t){var e=n(this,t);return!!e&&e.enumerable}:r},2967:(t,e,r)=>{var n=r(6706),i=r(34),o=r(7750),a=r(3506);t.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,r={};try{(t=n(Object.prototype,"__proto__","set"))(r,[]),e=r instanceof Array}catch(t){}return function(r,n){return o(r),a(n),i(r)?(e?t(r,n):r.__proto__=n,r):r}}():void 0)},4270:(t,e,r)=>{var n=r(9565),i=r(4901),o=r(34),a=TypeError;t.exports=function(t,e){var r,s;if("string"===e&&i(r=t.toString)&&!o(s=n(r,t)))return s;if(i(r=t.valueOf)&&!o(s=n(r,t)))return s;if("string"!==e&&i(r=t.toString)&&!o(s=n(r,t)))return s;throw new a("Can't convert object to primitive value")}},5031:(t,e,r)=>{var n=r(7751),i=r(9504),o=r(8480),a=r(3717),s=r(8551),c=i([].concat);t.exports=n("Reflect","ownKeys")||function(t){var e=o.f(s(t)),r=a.f;return r?c(e,r(t)):e}},1056:(t,e,r)=>{var n=r(4913).f;t.exports=function(t,e,r){r in t||n(t,r,{configurable:!0,get:function(){return e[r]},set:function(t){e[r]=t}})}},7750:(t,e,r)=>{var n=r(4117),i=TypeError;t.exports=function(t){if(n(t))throw new i("Can't call method on "+t);return t}},9286:(t,e,r)=>{var n=r(4402),i=r(8469),o=n.Set,a=n.add;t.exports=function(t){var e=new o;return i(t,function(t){a(e,t)}),e}},3440:(t,e,r)=>{var n=r(7080),i=r(4402),o=r(9286),a=r(5170),s=r(3789),c=r(8469),l=r(507),u=i.has,h=i.remove;t.exports=function(t){var e=n(this),r=s(t),i=o(e);return a(e)<=r.size?c(e,function(t){r.includes(t)&&h(i,t)}):l(r.getIterator(),function(t){u(e,t)&&h(i,t)}),i}},4402:(t,e,r)=>{var n=r(9504),i=Set.prototype;t.exports={Set,add:n(i.add),has:n(i.has),remove:n(i.delete),proto:i}},8750:(t,e,r)=>{var n=r(7080),i=r(4402),o=r(5170),a=r(3789),s=r(8469),c=r(507),l=i.Set,u=i.add,h=i.has;t.exports=function(t){var e=n(this),r=a(t),i=new l;return o(e)>r.size?c(r.getIterator(),function(t){h(e,t)&&u(i,t)}):s(e,function(t){r.includes(t)&&u(i,t)}),i}},4449:(t,e,r)=>{var n=r(7080),i=r(4402).has,o=r(5170),a=r(3789),s=r(8469),c=r(507),l=r(9539);t.exports=function(t){var e=n(this),r=a(t);if(o(e)<=r.size)return!1!==s(e,function(t){if(r.includes(t))return!1},!0);var u=r.getIterator();return!1!==c(u,function(t){if(i(e,t))return l(u,"normal",!1)})}},3838:(t,e,r)=>{var n=r(7080),i=r(5170),o=r(8469),a=r(3789);t.exports=function(t){var e=n(this),r=a(t);return!(i(e)>r.size)&&!1!==o(e,function(t){if(!r.includes(t))return!1},!0)}},8527:(t,e,r)=>{var n=r(7080),i=r(4402).has,o=r(5170),a=r(3789),s=r(507),c=r(9539);t.exports=function(t){var e=n(this),r=a(t);if(o(e)<r.size)return!1;var l=r.getIterator();return!1!==s(l,function(t){if(!i(e,t))return c(l,"normal",!1)})}},8469:(t,e,r)=>{var n=r(9504),i=r(507),o=r(4402),a=o.Set,s=o.proto,c=n(s.forEach),l=n(s.keys),u=l(new a).next;t.exports=function(t,e,r){return r?i({iterator:l(t),next:u},e):c(t,e)}},4916:(t,e,r)=>{var n=r(7751),i=function(t){return{size:t,has:function(){return!1},keys:function(){return{next:function(){return{done:!0}}}}}};t.exports=function(t){var e=n("Set");try{(new e)[t](i(0));try{return(new e)[t](i(-1)),!1}catch(t){return!0}}catch(t){return!1}}},5170:(t,e,r)=>{var n=r(6706),i=r(4402);t.exports=n(i.proto,"size","get")||function(t){return t.size}},3650:(t,e,r)=>{var n=r(7080),i=r(4402),o=r(9286),a=r(3789),s=r(507),c=i.add,l=i.has,u=i.remove;t.exports=function(t){var e=n(this),r=a(t).getIterator(),i=o(e);return s(r,function(t){l(e,t)?u(i,t):c(i,t)}),i}},4204:(t,e,r)=>{var n=r(7080),i=r(4402).add,o=r(9286),a=r(3789),s=r(507);t.exports=function(t){var e=n(this),r=a(t).getIterator(),c=o(e);return s(r,function(t){i(c,t)}),c}},6119:(t,e,r)=>{var n=r(5745),i=r(3392),o=n("keys");t.exports=function(t){return o[t]||(o[t]=i(t))}},7629:(t,e,r)=>{var n=r(6395),i=r(4576),o=r(9433),a="__core-js_shared__",s=t.exports=i[a]||o(a,{});(s.versions||(s.versions=[])).push({version:"3.38.1",mode:n?"pure":"global",copyright:"Â© 2014-2024 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.38.1/LICENSE",source:"https://github.com/zloirock/core-js"})},5745:(t,e,r)=>{var n=r(7629);t.exports=function(t,e){return n[t]||(n[t]=e||{})}},1548:(t,e,r)=>{var n=r(4576),i=r(9039),o=r(9519),a=r(4215),s=n.structuredClone;t.exports=!!s&&!i(function(){if("DENO"===a&&o>92||"NODE"===a&&o>94||"BROWSER"===a&&o>97)return!1;var t=new ArrayBuffer(8),e=s(t,{transfer:[t]});return 0!==t.byteLength||8!==e.byteLength})},4495:(t,e,r)=>{var n=r(9519),i=r(9039),o=r(4576).String;t.exports=!!Object.getOwnPropertySymbols&&!i(function(){var t=Symbol("symbol detection");return!o(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&n&&n<41})},5610:(t,e,r)=>{var n=r(1291),i=Math.max,o=Math.min;t.exports=function(t,e){var r=n(t);return r<0?i(r+e,0):o(r,e)}},5854:(t,e,r)=>{var n=r(2777),i=TypeError;t.exports=function(t){var e=n(t,"number");if("number"==typeof e)throw new i("Can't convert number to bigint");return BigInt(e)}},7696:(t,e,r)=>{var n=r(1291),i=r(8014),o=RangeError;t.exports=function(t){if(void 0===t)return 0;var e=n(t),r=i(e);if(e!==r)throw new o("Wrong length or index");return r}},5397:(t,e,r)=>{var n=r(7055),i=r(7750);t.exports=function(t){return n(i(t))}},1291:(t,e,r)=>{var n=r(741);t.exports=function(t){var e=+t;return e!=e||0===e?0:n(e)}},8014:(t,e,r)=>{var n=r(1291),i=Math.min;t.exports=function(t){var e=n(t);return e>0?i(e,9007199254740991):0}},8981:(t,e,r)=>{var n=r(7750),i=Object;t.exports=function(t){return i(n(t))}},8229:(t,e,r)=>{var n=r(9590),i=RangeError;t.exports=function(t,e){var r=n(t);if(r%e)throw new i("Wrong offset");return r}},9590:(t,e,r)=>{var n=r(1291),i=RangeError;t.exports=function(t){var e=n(t);if(e<0)throw new i("The argument can't be less than 0");return e}},2777:(t,e,r)=>{var n=r(9565),i=r(34),o=r(757),a=r(5966),s=r(4270),c=r(8227),l=TypeError,u=c("toPrimitive");t.exports=function(t,e){if(!i(t)||o(t))return t;var r,c=a(t,u);if(c){if(void 0===e&&(e="default"),r=n(c,t,e),!i(r)||o(r))return r;throw new l("Can't convert object to primitive value")}return void 0===e&&(e="number"),s(t,e)}},6969:(t,e,r)=>{var n=r(2777),i=r(757);t.exports=function(t){var e=n(t,"string");return i(e)?e:e+""}},2140:(t,e,r)=>{var n={};n[r(8227)("toStringTag")]="z",t.exports="[object z]"===String(n)},655:(t,e,r)=>{var n=r(6955),i=String;t.exports=function(t){if("Symbol"===n(t))throw new TypeError("Cannot convert a Symbol value to a string");return i(t)}},6823:t=>{var e=String;t.exports=function(t){try{return e(t)}catch(t){return"Object"}}},3392:(t,e,r)=>{var n=r(9504),i=0,o=Math.random(),a=n(1..toString);t.exports=function(t){return"Symbol("+(void 0===t?"":t)+")_"+a(++i+o,36)}},9143:(t,e,r)=>{var n=r(4576),i=r(9504),o=r(3972),a=r(3463),s=r(9297),c=r(2804),l=r(944),u=r(5169),h=c.c2i,d=c.c2iUrl,f=n.SyntaxError,g=n.TypeError,p=i("".charAt),y=function(t,e){for(var r=t.length;e<r;e++){var n=p(t,e);if(" "!==n&&"\t"!==n&&"\n"!==n&&"\f"!==n&&"\r"!==n)break}return e},m=function(t,e,r){var n=t.length;n<4&&(t+=2===n?"AA":"A");var i=(e[p(t,0)]<<18)+(e[p(t,1)]<<12)+(e[p(t,2)]<<6)+e[p(t,3)],o=[i>>16&255,i>>8&255,255&i];if(2===n){if(r&&0!==o[1])throw new f("Extra bits");return[o[0]]}if(3===n){if(r&&0!==o[2])throw new f("Extra bits");return[o[0],o[1]]}return o},v=function(t,e,r){for(var n=e.length,i=0;i<n;i++)t[r+i]=e[i];return r+n};t.exports=function(t,e,r,n){a(t),o(e);var i="base64"===l(e)?h:d,c=e?e.lastChunkHandling:void 0;if(void 0===c&&(c="loose"),"loose"!==c&&"strict"!==c&&"stop-before-partial"!==c)throw new g("Incorrect `lastChunkHandling` option");r&&u(r.buffer);var w=r||[],b=0,S=0,E="",T=0;if(n)for(;;){if((T=y(t,T))===t.length){if(E.length>0){if("stop-before-partial"===c)break;if("loose"!==c)throw new f("Missing padding");if(1===E.length)throw new f("Malformed padding: exactly one additional character");b=v(w,m(E,i,!1),b)}S=t.length;break}var I=p(t,T);if(++T,"="===I){if(E.length<2)throw new f("Padding is too early");if(T=y(t,T),2===E.length){if(T===t.length){if("stop-before-partial"===c)break;throw new f("Malformed padding: only one =")}"="===p(t,T)&&(++T,T=y(t,T))}if(T<t.length)throw new f("Unexpected character after padding");b=v(w,m(E,i,"strict"===c),b),S=t.length;break}if(!s(i,I))throw new f("Unexpected character");var x=n-b;if(1===x&&2===E.length||2===x&&3===E.length)break;if(4===(E+=I).length&&(b=v(w,m(E,i,!1),b),E="",S=T,b===n))break}return{bytes:w,read:S,written:b}}},2303:(t,e,r)=>{var n=r(4576),i=r(9504),o=n.Uint8Array,a=n.SyntaxError,s=n.parseInt,c=Math.min,l=/[^\da-f]/i,u=i(l.exec),h=i("".slice);t.exports=function(t,e){var r=t.length;if(r%2!=0)throw new a("String should be an even number of characters");for(var n=e?c(e.length,r/2):r/2,i=e||new o(n),d=0,f=0;f<n;){var g=h(t,d,d+=2);if(u(l,g))throw new a("String should only contain hex characters");i[f++]=s(g,16)}return{bytes:i,read:d}}},7040:(t,e,r)=>{var n=r(4495);t.exports=n&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},8686:(t,e,r)=>{var n=r(3724),i=r(9039);t.exports=n&&i(function(){return 42!==Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype})},2812:t=>{var e=TypeError;t.exports=function(t,r){if(t<r)throw new e("Not enough arguments");return t}},8622:(t,e,r)=>{var n=r(4576),i=r(4901),o=n.WeakMap;t.exports=i(o)&&/native code/.test(String(o))},8227:(t,e,r)=>{var n=r(4576),i=r(5745),o=r(9297),a=r(3392),s=r(4495),c=r(7040),l=n.Symbol,u=i("wks"),h=c?l.for||l:l&&l.withoutSetter||a;t.exports=function(t){return o(u,t)||(u[t]=s&&o(l,t)?l[t]:h("Symbol."+t)),u[t]}},4601:(t,e,r)=>{var n=r(7751),i=r(9297),o=r(6699),a=r(1625),s=r(2967),c=r(7740),l=r(1056),u=r(3167),h=r(2603),d=r(7584),f=r(747),g=r(3724),p=r(6395);t.exports=function(t,e,r,y){var m="stackTraceLimit",v=y?2:1,w=t.split("."),b=w[w.length-1],S=n.apply(null,w);if(S){var E=S.prototype;if(!p&&i(E,"cause")&&delete E.cause,!r)return S;var T=n("Error"),I=e(function(t,e){var r=h(y?e:t,void 0),n=y?new S(t):new S;return void 0!==r&&o(n,"message",r),f(n,I,n.stack,2),this&&a(E,this)&&u(n,this,I),arguments.length>v&&d(n,arguments[v]),n});if(I.prototype=E,"Error"!==b?s?s(I,T):c(I,T,{name:!0}):g&&m in S&&(l(I,S,m),l(I,S,"prepareStackTrace")),c(I,S),!p)try{E.name!==b&&o(E,"name",b),E.constructor=I}catch(t){}return I}}},6573:(t,e,r)=>{var n=r(3724),i=r(2106),o=r(3238),a=ArrayBuffer.prototype;n&&!("detached"in a)&&i(a,"detached",{configurable:!0,get:function(){return o(this)}})},7936:(t,e,r)=>{var n=r(6518),i=r(5636);i&&n({target:"ArrayBuffer",proto:!0},{transferToFixedLength:function(){return i(this,arguments.length?arguments[0]:void 0,!1)}})},8100:(t,e,r)=>{var n=r(6518),i=r(5636);i&&n({target:"ArrayBuffer",proto:!0},{transfer:function(){return i(this,arguments.length?arguments[0]:void 0,!0)}})},4114:(t,e,r)=>{var n=r(6518),i=r(8981),o=r(6198),a=r(4527),s=r(6837);n({target:"Array",proto:!0,arity:1,forced:r(9039)(function(){return 4294967297!==[].push.call({length:4294967296},1)})||!function(){try{Object.defineProperty([],"length",{writable:!1}).push()}catch(t){return t instanceof TypeError}}()},{push:function(t){var e=i(this),r=o(e),n=arguments.length;s(r+n);for(var c=0;c<n;c++)e[r]=arguments[c],r++;return a(e,r),r}})},6280:(t,e,r)=>{var n=r(6518),i=r(4576),o=r(8745),a=r(4601),s="WebAssembly",c=i[s],l=7!==new Error("e",{cause:7}).cause,u=function(t,e){var r={};r[t]=a(t,e,l),n({global:!0,constructor:!0,arity:1,forced:l},r)},h=function(t,e){if(c&&c[t]){var r={};r[t]=a(s+"."+t,e,l),n({target:s,stat:!0,constructor:!0,arity:1,forced:l},r)}};u("Error",function(t){return function(e){return o(t,this,arguments)}}),u("EvalError",function(t){return function(e){return o(t,this,arguments)}}),u("RangeError",function(t){return function(e){return o(t,this,arguments)}}),u("ReferenceError",function(t){return function(e){return o(t,this,arguments)}}),u("SyntaxError",function(t){return function(e){return o(t,this,arguments)}}),u("TypeError",function(t){return function(e){return o(t,this,arguments)}}),u("URIError",function(t){return function(e){return o(t,this,arguments)}}),h("CompileError",function(t){return function(e){return o(t,this,arguments)}}),h("LinkError",function(t){return function(e){return o(t,this,arguments)}}),h("RuntimeError",function(t){return function(e){return o(t,this,arguments)}})},7642:(t,e,r)=>{var n=r(6518),i=r(3440);n({target:"Set",proto:!0,real:!0,forced:!r(4916)("difference")},{difference:i})},8004:(t,e,r)=>{var n=r(6518),i=r(9039),o=r(8750);n({target:"Set",proto:!0,real:!0,forced:!r(4916)("intersection")||i(function(){return"3,2"!==String(Array.from(new Set([1,2,3]).intersection(new Set([3,2]))))})},{intersection:o})},3853:(t,e,r)=>{var n=r(6518),i=r(4449);n({target:"Set",proto:!0,real:!0,forced:!r(4916)("isDisjointFrom")},{isDisjointFrom:i})},5876:(t,e,r)=>{var n=r(6518),i=r(3838);n({target:"Set",proto:!0,real:!0,forced:!r(4916)("isSubsetOf")},{isSubsetOf:i})},2475:(t,e,r)=>{var n=r(6518),i=r(8527);n({target:"Set",proto:!0,real:!0,forced:!r(4916)("isSupersetOf")},{isSupersetOf:i})},5024:(t,e,r)=>{var n=r(6518),i=r(3650);n({target:"Set",proto:!0,real:!0,forced:!r(4916)("symmetricDifference")},{symmetricDifference:i})},1698:(t,e,r)=>{var n=r(6518),i=r(4204);n({target:"Set",proto:!0,real:!0,forced:!r(4916)("union")},{union:i})},8140:(t,e,r)=>{var n=r(4644),i=r(6198),o=r(1291),a=n.aTypedArray;(0,n.exportTypedArrayMethod)("at",function(t){var e=a(this),r=i(e),n=o(t),s=n>=0?n:r+n;return s<0||s>=r?void 0:e[s]})},1134:(t,e,r)=>{var n=r(4644),i=r(3839).findLastIndex,o=n.aTypedArray;(0,n.exportTypedArrayMethod)("findLastIndex",function(t){return i(o(this),t,arguments.length>1?arguments[1]:void 0)})},1903:(t,e,r)=>{var n=r(4644),i=r(3839).findLast,o=n.aTypedArray;(0,n.exportTypedArrayMethod)("findLast",function(t){return i(o(this),t,arguments.length>1?arguments[1]:void 0)})},8845:(t,e,r)=>{var n=r(4576),i=r(9565),o=r(4644),a=r(6198),s=r(8229),c=r(8981),l=r(9039),u=n.RangeError,h=n.Int8Array,d=h&&h.prototype,f=d&&d.set,g=o.aTypedArray,p=o.exportTypedArrayMethod,y=!l(function(){var t=new Uint8ClampedArray(2);return i(f,t,{length:1,0:3},1),3!==t[1]}),m=y&&o.NATIVE_ARRAY_BUFFER_VIEWS&&l(function(){var t=new h(2);return t.set(1),t.set("2",1),0!==t[0]||2!==t[1]});p("set",function(t){g(this);var e=s(arguments.length>1?arguments[1]:void 0,1),r=c(t);if(y)return i(f,this,r,e);var n=this.length,o=a(r),l=0;if(o+e>n)throw new u("Wrong length");for(;l<o;)this[e+l]=r[l++]},!y||m)},7467:(t,e,r)=>{var n=r(7628),i=r(4644),o=i.aTypedArray,a=i.exportTypedArrayMethod,s=i.getTypedArrayConstructor;a("toReversed",function(){return n(o(this),s(this))})},4732:(t,e,r)=>{var n=r(4644),i=r(9504),o=r(9306),a=r(5370),s=n.aTypedArray,c=n.getTypedArrayConstructor,l=n.exportTypedArrayMethod,u=i(n.TypedArrayPrototype.sort);l("toSorted",function(t){void 0!==t&&o(t);var e=s(this),r=a(c(e),e);return u(r,t)})},9577:(t,e,r)=>{var n=r(9928),i=r(4644),o=r(1108),a=r(1291),s=r(5854),c=i.aTypedArray,l=i.getTypedArrayConstructor,u=i.exportTypedArrayMethod,h=!!function(){try{new Int8Array(1).with(2,{valueOf:function(){throw 8}})}catch(t){return 8===t}}();u("with",{with:function(t,e){var r=c(this),i=a(t),u=o(r)?s(e):+e;return n(r,l(r),i,u)}}.with,!h)},8992:(t,e,r)=>{var n=r(6518),i=r(4576),o=r(679),a=r(8551),s=r(4901),c=r(2787),l=r(2106),u=r(4659),h=r(9039),d=r(9297),f=r(8227),g=r(7657).IteratorPrototype,p=r(3724),y=r(6395),m="constructor",v="Iterator",w=f("toStringTag"),b=TypeError,S=i[v],E=y||!s(S)||S.prototype!==g||!h(function(){S({})}),T=function(){if(o(this,g),c(this)===g)throw new b("Abstract class Iterator not directly constructable")},I=function(t,e){p?l(g,t,{configurable:!0,get:function(){return e},set:function(e){if(a(this),this===g)throw new b("You can't redefine this property");d(this,t)?this[t]=e:u(this,t,e)}}):g[t]=e};d(g,w)||I(w,v),!E&&d(g,m)&&g[m]!==Object||I(m,T),T.prototype=g,n({global:!0,constructor:!0,forced:E},{Iterator:T})},4520:(t,e,r)=>{var n=r(6518),i=r(9565),o=r(9306),a=r(8551),s=r(1767),c=r(9462),l=r(6319),u=r(6395),h=c(function(){for(var t,e,r=this.iterator,n=this.predicate,o=this.next;;){if(t=a(i(o,r)),this.done=!!t.done)return;if(e=t.value,l(r,n,[e,this.counter++],!0))return e}});n({target:"Iterator",proto:!0,real:!0,forced:u},{filter:function(t){return a(this),o(t),new h(s(this),{predicate:t})}})},3949:(t,e,r)=>{var n=r(6518),i=r(2652),o=r(9306),a=r(8551),s=r(1767);n({target:"Iterator",proto:!0,real:!0},{forEach:function(t){a(this),o(t);var e=s(this),r=0;i(e,function(e){t(e,r++)},{IS_RECORD:!0})}})},1454:(t,e,r)=>{var n=r(6518),i=r(713);n({target:"Iterator",proto:!0,real:!0,forced:r(6395)},{map:i})},8872:(t,e,r)=>{var n=r(6518),i=r(2652),o=r(9306),a=r(8551),s=r(1767),c=TypeError;n({target:"Iterator",proto:!0,real:!0},{reduce:function(t){a(this),o(t);var e=s(this),r=arguments.length<2,n=r?void 0:arguments[1],l=0;if(i(e,function(e){r?(r=!1,n=e):n=t(n,e,l),l++},{IS_RECORD:!0}),r)throw new c("Reduce of empty iterator with no initial value");return n}})},7550:(t,e,r)=>{var n=r(6518),i=r(2652),o=r(9306),a=r(8551),s=r(1767);n({target:"Iterator",proto:!0,real:!0},{some:function(t){a(this),o(t);var e=s(this),r=0;return i(e,function(e,n){if(t(e,r++))return n()},{IS_RECORD:!0,INTERRUPTED:!0}).stopped}})},1549:(t,e,r)=>{var n=r(6518),i=r(4576),o=r(9143),a=r(4154);i.Uint8Array&&n({target:"Uint8Array",proto:!0},{setFromBase64:function(t){a(this);var e=o(t,arguments.length>1?arguments[1]:void 0,this,this.length);return{read:e.read,written:e.written}}})},9797:(t,e,r)=>{var n=r(6518),i=r(4576),o=r(3463),a=r(4154),s=r(5169),c=r(2303);i.Uint8Array&&n({target:"Uint8Array",proto:!0},{setFromHex:function(t){a(this),o(t),s(this.buffer);var e=c(t,this).read;return{read:e,written:e/2}}})},9631:(t,e,r)=>{var n=r(6518),i=r(4576),o=r(9504),a=r(3972),s=r(4154),c=r(5169),l=r(2804),u=r(944),h=l.i2c,d=l.i2cUrl,f=o("".charAt);i.Uint8Array&&n({target:"Uint8Array",proto:!0},{toBase64:function(){var t=s(this),e=arguments.length?a(arguments[0]):void 0,r="base64"===u(e)?h:d,n=!!e&&!!e.omitPadding;c(this.buffer);for(var i,o="",l=0,g=t.length,p=function(t){return f(r,i>>6*t&63)};l+2<g;l+=3)i=(t[l]<<16)+(t[l+1]<<8)+t[l+2],o+=p(3)+p(2)+p(1)+p(0);return l+2===g?(i=(t[l]<<16)+(t[l+1]<<8),o+=p(3)+p(2)+p(1)+(n?"":"=")):l+1===g&&(i=t[l]<<16,o+=p(3)+p(2)+(n?"":"==")),o}})},5623:(t,e,r)=>{var n=r(6518),i=r(4576),o=r(9504),a=r(4154),s=r(5169),c=o(1..toString);i.Uint8Array&&n({target:"Uint8Array",proto:!0},{toHex:function(){a(this),s(this.buffer);for(var t="",e=0,r=this.length;e<r;e++){var n=c(this[e],16);t+=1===n.length?"0"+n:n}return t}})},4979:(t,e,r)=>{var n=r(6518),i=r(4576),o=r(7751),a=r(6980),s=r(4913).f,c=r(9297),l=r(679),u=r(3167),h=r(2603),d=r(5002),f=r(6193),g=r(3724),p=r(6395),y="DOMException",m=o("Error"),v=o(y),w=function(){l(this,b);var t=arguments.length,e=h(t<1?void 0:arguments[0]),r=h(t<2?void 0:arguments[1],"Error"),n=new v(e,r),i=new m(e);return i.name=y,s(n,"stack",a(1,f(i.stack,1))),u(n,this,w),n},b=w.prototype=v.prototype,S="stack"in new m(y),E="stack"in new v(1,2),T=v&&g&&Object.getOwnPropertyDescriptor(i,y),I=!(!T||T.writable&&T.configurable),x=S&&!I&&!E;n({global:!0,constructor:!0,forced:p||x},{DOMException:x?w:v});var A=o(y),k=A.prototype;if(k.constructor!==A)for(var R in p||s(k,"constructor",a(1,A)),d)if(c(d,R)){var O=d[R],_=O.s;c(A,_)||s(A,_,a(6,O.c))}},4603:(t,e,r)=>{var n=r(6840),i=r(9504),o=r(655),a=r(2812),s=URLSearchParams,c=s.prototype,l=i(c.append),u=i(c.delete),h=i(c.forEach),d=i([].push),f=new s("a=1&a=2&b=3");f.delete("a",1),f.delete("b",void 0),f+""!="a=2"&&n(c,"delete",function(t){var e=arguments.length,r=e<2?void 0:arguments[1];if(e&&void 0===r)return u(this,t);var n=[];h(this,function(t,e){d(n,{key:e,value:t})}),a(e,1);for(var i,s=o(t),c=o(r),f=0,g=0,p=!1,y=n.length;f<y;)i=n[f++],p||i.key===s?(p=!0,u(this,i.key)):g++;for(;g<y;)(i=n[g++]).key===s&&i.value===c||l(this,i.key,i.value)},{enumerable:!0,unsafe:!0})},7566:(t,e,r)=>{var n=r(6840),i=r(9504),o=r(655),a=r(2812),s=URLSearchParams,c=s.prototype,l=i(c.getAll),u=i(c.has),h=new s("a=1");!h.has("a",2)&&h.has("a",void 0)||n(c,"has",function(t){var e=arguments.length,r=e<2?void 0:arguments[1];if(e&&void 0===r)return u(this,t);var n=l(this,t);a(e,1);for(var i=o(r),s=0;s<n.length;)if(n[s++]===i)return!0;return!1},{enumerable:!0,unsafe:!0})},8721:(t,e,r)=>{var n=r(3724),i=r(9504),o=r(2106),a=URLSearchParams.prototype,s=i(a.forEach);n&&!("size"in a)&&o(a,"size",{get:function(){var t=0;return s(this,function(){t++}),t},configurable:!0,enumerable:!0})}},e={};function r(n){var i=e[n];if(void 0!==i)return i.exports;var o=e[n]={exports:{}};return t[n].call(o.exports,o,o.exports,r),o.exports}async function n(t){if(!window.crypto||!window.crypto.subtle)return null;const e=(new TextEncoder).encode(t),r=await window.crypto.subtle.digest("SHA-256",e);return Array.from(new Uint8Array(r)).map(t=>t.toString(16).padStart(2,"0")).join("")}function i(t,e){try{if(!chrome||!chrome.runtime||"function"!=typeof chrome.runtime.sendMessage)return void("function"==typeof e&&e(null));chrome.runtime.sendMessage(t,t=>{try{if(chrome.runtime&&chrome.runtime.lastError)return void("function"==typeof e&&e(null))}catch(t){}"function"==typeof e&&e(t)})}catch(t){try{"function"==typeof e&&e(null)}catch(t){}}}r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),r(6280),r(4114),r(6573),r(8100),r(7936),r(7642),r(8004),r(3853),r(5876),r(2475),r(5024),r(1698),r(8140),r(1903),r(1134),r(8845),r(7467),r(4732),r(9577),r(8992),r(4520),r(3949),r(1454),r(8872),r(7550),r(1549),r(9797),r(9631),r(5623),r(4979),r(4603),r(7566),r(8721);class o{constructor(t={}){this.config={cacheDuration:t.cacheDuration||36e5,startDelayMs:t.startDelayMs||2e3,abuseIPKey:t.abuseIPKey||null,safeBrowsingKey:t.safeBrowsingKey||null,braveSearchKey:t.braveSearchKey||null,logLevel:t.logLevel||"info",retryAttempts:t.retryAttempts||3,threatThreshold:t.threatThreshold||.5,abuseSubmissionOptIn:t.abuseSubmissionOptIn||!1,mutationRateThreshold:t.mutationRateThreshold||100,domainInfoCacheTTL:6048e5,debounceMs:t.debounceMs||500,maxScansPerBatch:t.maxScansPerBatch||20,scanCacheTTL:t.scanCacheTTL||36e5},this.gurftronId=t.gurftronId,this.threatsCache=new Map,this.domainCache=new Map,this.pageScans=new Map,this.scannedElements=new WeakMap,this.monitors=new Set,this.isMonitoring=!1,this.currentUrl=window.location.href,this.historyStack=[window.location.href],this.metrics={scans:0,threatsDetected:0,llmCalls:0},this.threatsLog=[],this.signalStore=new Map,this.signalTTL=t.signalTTL||6e4,this.minSignals=t.minSignals||1,this.mutationCount=0,this.lastMutationTime=Date.now(),this.initConfig(),this.log("info","Gurftron Threat Detector v1.0.0 initialized with advanced threat detection")}async initConfig(){return new Promise(t=>{chrome.storage.sync.get(Object.keys(this.config),e=>{Object.assign(this.config,e),this.log("debug","Configuration loaded"),t()})})}clearAllCaches(){this.threatsCache.clear(),this.domainCache.clear(),this.pageScans.clear(),this.scannedElements=new WeakMap,this.signalStore.clear(),this.log("info","ðŸ§¹ All caches cleared! Ready for fresh scan."),console.log("âœ… Gurftron caches cleared. You can now run: window.gurftronDetector.fullScan()")}setupInjectorGuard(){this.setupIntelligenceListener(),this.ensureInjectorInterval=setInterval(async()=>{try{if(!document.querySelector('[id^="starknet-extension-injected-"], script[data-gurftron]')){try{await this.reinjectScript(),this.log("warn","Re-injected script element")}catch(t){this.log("error","Re-inject failed:",t.message)}const t=await this.createThreatJson(this.currentUrl,"Injected script was removed by page; re-injected by extension","tamper","high",null,null,"Injected script removed");await this.handleThreatFound(t)}}catch(t){this.log("error","ensureInjectorInterval error:",t.message)}},5e3);try{this.injectorRemovalObserver=new MutationObserver(t=>{for(const e of t)if("childList"===e.type&&e.removedNodes&&e.removedNodes.length)for(const t of e.removedNodes)try{t&&1===t.nodeType&&(t.id&&t.id.startsWith("starknet-extension-injected-")||t.getAttribute&&t.getAttribute("data-gurftron")===this.gurftronId)&&(async()=>{try{const t="Injected script element removed from DOM",e=await this.createThreatJson(this.currentUrl,t,"tamper_injection_removal","high",null,null,"Injected script removed by page mutation");await this.handleThreatFound(e),await this.reinjectScript()}catch(t){this.log("error","injector removal handler failed:",t.message)}})()}catch(t){}}),this.injectorRemovalObserver.observe(document.documentElement||document,{childList:!0,subtree:!0}),this.monitors.add(this.injectorRemovalObserver)}catch(t){this.log("warn","Failed to attach injector removal observer:",t&&t.message)}}async reinjectScript(){try{const t=document.createElement("script");try{t.src=chrome.runtime.getURL("gurftron.js")}catch(e){t.src="gurftron.js"}const e=`gurftron-extension-injected-${window.gurftronPageId||"unknown"}`;t.id=e;const r=await new Promise(t=>{try{i({type:"GURFTRON_GET_INJECT_SIGNATURE",injectedId:e,secureId:window.gurftronPageId},e=>{t(e||{})})}catch(e){t({})}});return r&&r.signature?(t.setAttribute("data-gurftron",window.gurftronPageId||"gurftron_unknown"),t.setAttribute("data-gurftron-sig",r.signature),t.setAttribute("data-gurftron-ts",r.ts)):t.setAttribute("data-gurftron",window.gurftronPageId||"gurftron_unknown"),(document.head||document.documentElement).appendChild(t),!0}catch(t){return this.log("error","reinjectScript failed:",t&&t.message),!1}}async updateConfig(t){return Object.assign(this.config,t),new Promise(e=>{chrome.storage.sync.set(t,()=>{this.log("info","Configuration updated"),e()})})}log(t,...e){const r=`[Gurftron ${(new Date).toISOString()} ${t.toUpperCase()}] ${e.join(" ")}`;try{console&&"function"==typeof console[t]?console[t](r):console.log(r)}catch(t){try{console.log(r)}catch(t){}}if({debug:0,info:1,warn:2,error:3}[t]>=2)try{chrome&&chrome.runtime&&"function"==typeof chrome.runtime.sendMessage&&chrome.runtime.sendMessage({action:"log_error_to_db",error:{message:r,stack:(new Error).stack},source:"content.js",level:t},t=>{try{if(chrome.runtime.lastError)return}catch(t){}})}catch(t){}}updateMetrics(){try{i({action:"update_metrics",metrics:this.metrics},t=>{t&&t.success?this.log("debug","Metrics updated in IndexedDB"):this.log("warn","Failed to update metrics:",null==t?void 0:t.error)})}catch(t){this.log("error","Failed to send metrics update:",t.message)}}async retryOp(t,e=this.config.retryAttempts){let r;for(let n=1;n<=e;n++)try{return await t()}catch(t){r=t,this.log("warn",`Retry attempt ${n}/${e} failed:`,t.message),n<e&&await new Promise(t=>setTimeout(t,1e3*n))}throw r}isResourceCached(t){const e=this.pageScans.get(t);return!!e&&Date.now()-e<this.config.scanCacheTTL}markResourceScanned(t){this.pageScans.set(t,Date.now())}async checkThreatInDB(t){return new Promise(e=>{i({type:"GURFTRON_GET_THREAT",url:t},t=>{try{if(t&&Array.isArray(t.threats)&&t.threats.length>0){const r=t.threats[0],n=(null==r?void 0:r.data)||r;return void e(n||null)}}catch(t){}e((null==t?void 0:t.threat)||null)})})}async storeThreatInDB(t){return new Promise(e=>{try{if(!t||!t._tx)return void e(!1);i({type:"GURFTRON_STORE_THREAT",threat:t},t=>{e((null==t?void 0:t.success)||!1)})}catch(t){e(!1)}})}extractDomain(t){try{return new URL(t).hostname.replace(/^www\./,"")}catch{return t.replace(/^https?:\/\/(www\.)?/,"").split("/")[0]}}async getDomainInfo(t){if(this.domainCache.has(t)){const e=this.domainCache.get(t);if(Date.now()-e.timestamp<this.config.domainInfoCacheTTL)return e.data}return new Promise(e=>{chrome.runtime.sendMessage({action:"get_domain_info",domain:t},r=>{r&&!r.error?(this.domainCache.set(t,{data:r,timestamp:Date.now()}),e(r)):e(null)})})}async deepSearchForImpersonation(t,e,r,n){return new Promise(i=>{chrome.runtime.sendMessage({action:"brave_deep_search",originalUrl:t,pageTitle:e,pageContent:(null==r?void 0:r.substring(0,1e3))||"",originalDomain:n},t=>{i((null==t?void 0:t.evidence)||[])})})}async analyzeWithLLM(t,e,r={}){this.metrics.llmCalls++,this.updateMetrics(),this.log("info",`ðŸ¤– LLM Analysis Started: ${e}`),r=Object.assign({passFullQuoted:!0},r||{});let n=t;if(r.passFullQuoted&&"string"==typeof t){const e=t.replace(/\"\"\"/g,'\\"\\"\\"');n=`"""${e}"""`}return new Promise((t,r)=>{chrome.runtime.sendMessage({action:"llm_analyze",text:n,type:e},r=>chrome.runtime.lastError?(console.error("ðŸ¤– Chrome runtime error:",chrome.runtime.lastError),void t({threat:!1,confidence:0,details:chrome.runtime.lastError.message})):(console.log("ðŸ¤– LLM response:",r),this.log("info",`ðŸ¤– LLM Response: ${e} - Threat: ${null==r?void 0:r.threat}, Confidence: ${null==r?void 0:r.confidence}`),null!=r&&r.error?(console.error("ðŸ¤– LLM API error:",r.error),void t({threat:!1,confidence:0,details:r.error})):void t({threat:(null==r?void 0:r.threat)||!1,confidence:(null==r?void 0:r.confidence)||0,details:(null==r?void 0:r.details)||""})))})}sanitizeEvidence(t){return t&&"string"==typeof t?t.replace(/\"\"\"/g,'\\"\\"\\"'):""}async offloadApiCall(t,e){return new Promise(r=>{chrome.runtime.sendMessage({action:"api_call",api:t,params:e},t=>{r(t||{})})})}async offloadScan(t,e){return new Promise(r=>{chrome.runtime.sendMessage({action:"scan",type:t,data:e},t=>{r(t||{})})})}async collectPageData(t){var e,r;const n=`page_collection_${this.currentUrl}`;if(this.isResourceCached(n))return null;this.markResourceScanned(n);const i={url:this.currentUrl,title:document.title,textContent:(null===(e=document.body)||void 0===e||null===(e=e.innerText)||void 0===e?void 0:e.slice(0,5e3))||"",forms:Array.from(document.forms).map(t=>({action:t.action,method:t.method,elements:Array.from(t.elements).map(t=>{var e;return{tag:t.tagName,type:t.type,name:t.name,value:null===(e=t.value)||void 0===e?void 0:e.slice(0,200),hidden:"hidden"===t.type||"none"===t.style.display}})})),scripts:Array.from(document.scripts).map(t=>({src:t.src,innerHTML:t.innerHTML.slice(0,2e3),hasEval:/eval|Function|setTimeout|setInterval/i.test(t.innerHTML)})),links:Array.from(document.links).map(t=>t.href).slice(0,200),iframes:Array.from(document.querySelectorAll("iframe")).map(t=>({src:t.src,sandbox:t.sandbox.value,hidden:"none"===t.style.display})),canvasElements:Array.from(document.querySelectorAll("canvas")).length,behavioral:"click"===(null==t?void 0:t.type)?{clickTarget:null===(r=t.target)||void 0===r?void 0:r.tagName}:null,web3Event:(null==t?void 0:t.web3Event)||null,cookies:document.cookie.split(";").map(t=>({name:t.split("=")[0].trim()})),timestamp:Date.now()};let o="general page behavior";null!=t&&t.web3Event?o=`Web3 ${t.web3Event.provider} wallet interaction (${t.web3Event.method})`:"submit"===(null==t?void 0:t.type)?o="form submission behavior":"password_change"===(null==t?void 0:t.type)&&(o="password field interaction (credential harvesting check)");const a=`Analyze ${o} for malicious patterns, phishing attempts, crypto wallet draining, or suspicious behavior. Page data: ${JSON.stringify(i).slice(0,1e3)}. Return threat assessment with high confidence (>0.75) only for ACTUAL threats, not legitimate websites.`;return new Promise(e=>{chrome.runtime.sendMessage({action:"analyzeThreat",data:i,prompt:a},async r=>{try{if(r&&r.threat&&r.confidence>=.75){this.log("warn",`LLM detected threat via ${o}: confidence=${r.confidence}`);let e="behavioral_threat",n=r.confidence>.85?"high":"medium";null!=t&&t.web3Event?(e="web3_behavioral_threat",n="high"):"password_change"===(null==t?void 0:t.type)?(e="credential_harvesting",n="high"):"submit"===(null==t?void 0:t.type)&&(e="form_threat");const a=await this.createThreatJson(this.currentUrl,JSON.stringify(i).slice(0,500),e,n,null,null,r.details||`LLM-detected threat during ${o}`);await this.handleThreatFound(a)}else r&&r.threat&&r.confidence<.75&&this.log("info",`Low-confidence threat signal (${r.confidence}) - not triggering alert`);e(r)}catch(t){this.log("error","Failed to handle collectPageData threat:",t.message),e(null)}})})}setupIntelligenceListener(){this.intelligenceListener=async t=>{if(t.source!==window)return;if(!t.data||"gurftron:intelligence"!==t.data.type)return;const e=t.data.intelligence;if(e){this.log("debug","Received intelligence from injected script",{web3Count:e.summary.web3Count,behavioralCount:e.summary.behavioralCount,duration:e.summary.collectionDuration});try{const t=await new Promise(t=>{i({action:"analyzeThreat",data:{url:e.pageInfo.url,domain:e.pageInfo.domain,title:e.pageInfo.title,hasWeb3:e.pageInfo.hasWeb3,web3Events:e.web3Events,behavioralEvents:e.behavioralEvents,timestamp:e.timestamp}},t)});if(t&&t.result){const{threat:r,confidence:n,details:i}=t.result;if(this.log("info","LLM analysis complete",{threat:r,confidence:n,details:i}),r&&n>=.75){const t=await this.createThreatJson(e.pageInfo.url,`Web3: ${e.summary.web3Count} events, Behavioral: ${e.summary.behavioralCount} events`,"suspicious_activity",n>=.9?"critical":"high",null,null,i);await this.handleThreatFound(t)}}}catch(t){this.log("error","Failed to analyze intelligence",t)}}},window.addEventListener("message",this.intelligenceListener),window.postMessage({type:"gurftron:control",action:"start",pageToken:this.gurftronId},"*"),this.log("info","Intelligence listener setup complete")}startMonitoring(){if(this.isMonitoring)return;this.setupInjectorGuard();const t=new MutationObserver(t=>{this._pendingMutations||(this._pendingMutations=[]),this._pendingMutations.push(...t),this._debounceTimer&&clearTimeout(this._debounceTimer),this._debounceTimer=setTimeout(async()=>{const t=(this._pendingMutations||[]).splice(0,this._pendingMutations.length);try{let e=0,r=!1;const n=t.length;this.mutationCount+=n;const i=Date.now(),o=i-this.lastMutationTime;if(o>=1e3){const t=this.mutationCount/(o/1e3);if(t>this.config.mutationRateThreshold){const e=`Observed mutation rate: ${t}/s; threshold: ${this.config.mutationRateThreshold}`;try{const t=await this.analyzeWithLLM(this.sanitizeEvidence(e,500),"dom_behavior_threats");if(t.threat){const r=await this.createThreatJson(this.currentUrl,e,"abnormal_dom_behavior","high",null,null,t.details);this.recordThreat(r)}}catch(t){this.log("error","Mutation scan error:",t.message)}}this.mutationCount=0,this.lastMutationTime=i}for(const n of t)if("childList"===n.type)for(const t of n.addedNodes)try{if(e>=this.config.maxScansPerBatch)break;if(1!==t.nodeType)continue;if(t.getAttribute&&t.getAttribute("data-gurftron")===this.gurftronId)continue;try{if(this.shouldSkipScan(t))continue}catch(t){}r=!0;let n="";switch(t.tagName){case"SCRIPT":n=t.textContent||(t.src?await this.fetchContent(t.src):""),this.log("info","Scanning SCRIPT:",t.src||"[inline]");const r=await this.scanScript(this.sanitizeEvidence(n,3e3),t);this.markScanned(t,t.src||this.currentUrl,!!r),this.log("info","SCRIPT scan result:",r?JSON.stringify(r):"No threat detected"),e++;break;case"LINK":if("stylesheet"===t.rel&&t.href){n=await this.fetchContent(t.href),this.log("info","Scanning LINK stylesheet:",t.href);const r=await this.scanCss(this.sanitizeEvidence(n,2e3),t);this.markScanned(t,t.href||this.currentUrl,!!r),this.log("info","LINK scan result:",r?JSON.stringify(r):"No threat detected"),e++}break;case"FORM":this.log("info","Scanning FORM");const i=await this.scanForm(t);this.markScanned(t,t.action||this.currentUrl,!!i),this.log("info","FORM scan result:",i?JSON.stringify(i):"No threat detected"),e++;break;case"IFRAME":this.log("info","Scanning IFRAME:",t.src);const o=await this.scanUrl(t.src);this.markScanned(t,t.src||this.currentUrl,!!o),this.log("info","IFRAME scan result:",o?JSON.stringify(o):"No threat detected"),e++;break;case"IMG":this.log("info","Scanning IMG:",t.src);const a=await this.scanImage(t.src,t);this.markScanned(t,t.src||this.currentUrl,!!a),this.log("info","IMG scan result:",a?JSON.stringify(a):"No threat detected"),e++;break;case"A":this.log("info","Scanning A:",t.href);const s=await this.scanLink(this.sanitizeEvidence(t.href,2e3),t);this.markScanned(t,t.href||this.currentUrl,!!s),this.log("info","A scan result:",s?JSON.stringify(s):"No threat detected"),e++;break;case"OBJECT":case"EMBED":this.log("info","Scanning OBJECT/EMBED:",t.data||t.src);const c=await this.scanFileResource(t.data||t.src,t);this.log("info","OBJECT/EMBED scan result:",c?JSON.stringify(c):"No threat detected"),e++;break;default:const l=t.querySelectorAll(`script:not([data-gurftron="${this.gurftronId}"]), form, iframe, link[rel="stylesheet"], img, a, object, embed`);for(const t of l)try{if(e>=this.config.maxScansPerBatch)break;if(this.shouldSkipScan&&this.shouldSkipScan(t))continue;if("SCRIPT"===t.tagName){n=t.textContent||(t.src?await this.fetchContent(t.src):""),this.log("info","Scanning SCRIPT:",t.src||"[inline]");const r=await this.scanScript(this.sanitizeEvidence(n,3e3),t);this.markScanned(t,t.src||this.currentUrl,!!r),this.log("info","SCRIPT scan result:",r?JSON.stringify(r):"No threat detected"),e++}else if("LINK"===t.tagName&&"stylesheet"===t.rel&&t.href){n=await this.fetchContent(t.href),this.log("info","Scanning LINK stylesheet:",t.href);const r=await this.scanCss(this.sanitizeEvidence(n,2e3),t);this.markScanned(t,t.href||this.currentUrl,!!r),this.log("info","LINK scan result:",r?JSON.stringify(r):"No threat detected"),e++}else if("FORM"===t.tagName){this.log("info","Scanning FORM");const r=await this.scanForm(t);this.markScanned(t,t.action||this.currentUrl,!!r),this.log("info","FORM scan result:",r?JSON.stringify(r):"No threat detected"),e++}else if("IFRAME"===t.tagName){this.log("info","Scanning IFRAME:",t.src);const r=await this.scanUrl(t.src);this.markScanned(t,t.src||this.currentUrl,!!r),this.log("info","IFRAME scan result:",r?JSON.stringify(r):"No threat detected"),e++}else if("IMG"===t.tagName){this.log("info","Scanning IMG:",t.src);const r=await this.scanImage(t.src,t);this.markScanned(t,t.src||this.currentUrl,!!r),this.log("info","IMG scan result:",r?JSON.stringify(r):"No threat detected"),e++}else if("A"===t.tagName){this.log("info","Scanning A:",t.href);const r=await this.scanLink(this.sanitizeEvidence(t.href,2e3),t);this.markScanned(t,t.href||this.currentUrl,!!r),this.log("info","A scan result:",r?JSON.stringify(r):"No threat detected"),e++}else if("OBJECT"===t.tagName||"EMBED"===t.tagName){this.log("info","Scanning OBJECT/EMBED:",t.data||t.src);const r=await this.scanFileResource(t.data||t.src,t);this.markScanned(t,t.data||t.src||this.currentUrl,!!r),this.log("info","OBJECT/EMBED scan result:",r?JSON.stringify(r):"No threat detected"),e++}}catch(t){this.log("error","Element scan error:",t.message)}}}catch(t){this.log("error","Node scan error:",t.message)}else if("attributes"===n.type){const t=n.target;try{if("src"!==n.attributeName||"SCRIPT"!==t.tagName&&"IFRAME"!==t.tagName&&"IMG"!==t.tagName){if("href"!==n.attributeName||"LINK"!==t.tagName&&"A"!==t.tagName){if("action"===n.attributeName&&"FORM"===t.tagName){this.log("info","Scanning FORM (attribute change)");const e=await this.scanForm(t);this.log("info","FORM scan result:",e?JSON.stringify(e):"No threat detected")}else if("data"===n.attributeName&&"OBJECT"===t.tagName){this.log("info","Scanning OBJECT (attribute change):",t.data);const e=await this.scanFileResource(t.data,t);this.log("info","OBJECT scan result:",e?JSON.stringify(e):"No threat detected")}}else if("LINK"===t.tagName&&"stylesheet"===t.rel){this.log("info","Scanning LINK stylesheet (attribute change):",t.href);const e=await this.fetchContent(t.href),r=await this.scanCss(this.sanitizeEvidence(e,2e3),t);this.log("info","LINK scan result:",r?JSON.stringify(r):"No threat detected")}else if("A"===t.tagName){this.log("info","Scanning A (attribute change):",t.href);const e=await this.scanLink(this.sanitizeEvidence(t.href,2e3),t);this.log("info","A scan result:",e?JSON.stringify(e):"No threat detected")}}else if("IMG"===t.tagName){this.log("info","Scanning IMG (attribute change):",t.src);const e=await this.scanImage(t.src);this.log("info","IMG scan result:",e?JSON.stringify(e):"No threat detected")}else{this.log("info","Scanning SCRIPT/IFRAME (attribute change):",t.src);const e=await this.scanUrl(t.src);this.log("info","SCRIPT/IFRAME scan result:",e?JSON.stringify(e):"No threat detected")}}catch(t){this.log("error","Attribute scan error:",t.message)}}r&&(this.metrics.scans++,this.updateMetrics())}catch(t){this.log("error","Mutation batch processing failed:",t.message)}},this.config.debounceMs||500)}),e=document.documentElement||document;t.observe(e,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["src","href","action","data"]}),this.monitors.add(t),this.isMonitoring=!0,this.log("info","Mutation observer attached and monitoring started");try{window._gurftron_reportedScripts||(window._gurftron_reportedScripts=new Map);const t=new MutationObserver(t=>{for(const e of t)try{if("childList"===e.type){for(const t of e.addedNodes)if(t&&1===t.nodeType&&"SCRIPT"===t.tagName)try{const e=t.src||null;let r;r=e||(t.textContent&&t.textContent.length?"inline:"+t.textContent.slice(0,200).replace(/\s+/g," "):"inline:unknown:"+Date.now());const n=window._gurftron_reportedScripts.get(r),o=Date.now();if(n&&o-n<3e4)continue;window._gurftron_reportedScripts.set(r,o);const a=t.getAttribute&&t.getAttribute("data-gurftron-sig"),s=t.getAttribute&&t.getAttribute("data-gurftron-ts");try{i({action:"network_script_loaded",url:e||null,inline:!(e||!t.textContent),snippet:(t.textContent||"").slice(0,1e3),signature:a||null,sigTs:s||null})}catch(t){}}catch(t){this.log("debug","scriptObserver report failed:",t.message)}}else if("attributes"===e.type&&e.target&&"SCRIPT"===e.target.tagName&&"src"===e.attributeName){const t=e.target,r=t.src||null,n=r||null;if(!n)continue;const o=window._gurftron_reportedScripts.get(n),a=Date.now();if(o&&a-o<3e4)continue;window._gurftron_reportedScripts.set(n,a);try{i({action:"network_script_loaded",url:r,tabless:!0,signature:t.getAttribute&&t.getAttribute("data-gurftron-sig")||null,sigTs:t.getAttribute&&t.getAttribute("data-gurftron-ts")||null})}catch(t){}}}catch(t){}});t.observe(document.documentElement||document,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["src"]}),this.monitors.add(t),this.log("info","Content-side script reporter active")}catch(t){this.log("warn","Content-side script reporter unavailable:",t&&t.message)}(async()=>{try{this.log("info","Initial quick-scan starting to enumerate existing elements");const t=document.querySelectorAll(`script:not([data-gurftron="${this.gurftronId}"]), form, iframe, link[rel="stylesheet"], img, a, object, embed`);for(const e of t)try{if("SCRIPT"===e.tagName){this.log("info","Initial scan detected SCRIPT - scanning",e.src||"[inline]");const t=e.textContent||(e.src?await this.fetchContent(e.src):"");await this.scanScript(t,e)}else if("LINK"===e.tagName&&"stylesheet"===e.rel){this.log("info","Initial scan detected LINK stylesheet - scanning",e.href);const t=e.href?await this.fetchContent(e.href):"";await this.scanCss(t,e)}else"FORM"===e.tagName?(this.log("info","Initial scan detected FORM - scanning form element"),await this.scanForm(e)):"IFRAME"===e.tagName?(this.log("info","Initial scan detected IFRAME - scanning",e.src),await this.scanUrl(e.src)):"IMG"===e.tagName?(this.log("info","Initial scan detected IMG - scanning",e.src),await this.scanImage(e.src,e)):"A"===e.tagName?(this.log("info","Initial scan detected LINK element - scanning",e.href),await this.scanLink(e.href,e)):"OBJECT"!==e.tagName&&"EMBED"!==e.tagName||(this.log("info","Initial scan detected OBJECT/EMBED - scanning",e.data||e.src),await this.scanFileResource(e.data||e.src,e))}catch(t){this.log("error","Initial scan element error:",t.message)}this.log("info","Initial quick-scan complete")}catch(t){this.log("error","Initial quick-scan failed:",t.message)}})();const r=history.pushState;history.pushState=(...t)=>(this.historyStack.push(window.location.href),this.historyStack.length>5&&this.detectHijackingRedirections(),r.apply(history,t));const n=history.replaceState;if(history.replaceState=(...t)=>{const e=n.apply(history,t);try{this.handleUrlChange(window.location.href)}catch(t){}return e},window.addEventListener("popstate",t=>{try{this.handleUrlChange(window.location.href)}catch(t){}}),this.log("info","Comprehensive monitoring enabled"),document.addEventListener("click",this.collectPageData.bind(this),!0),window.ethereum){const t=window.ethereum.request;window.ethereum.request=(...e)=>{var r;return this.collectPageData({web3Event:{method:null===(r=e[0])||void 0===r?void 0:r.method,args:JSON.stringify(e)}}),t.apply(window.ethereum,e)}}if(window.starknet){const t=window.starknet.request;window.starknet.request=(...e)=>{var r;return this.collectPageData({web3Event:{method:null===(r=e[0])||void 0===r?void 0:r.method,args:JSON.stringify(e)}}),t.apply(window.starknet,e)}}window.addEventListener("load",this.collectPageData.bind(this)),setInterval(this.collectPageData.bind(this),5e3)}stopMonitoring(){this.monitors.forEach(t=>t.disconnect()),this.monitors.clear(),this.isMonitoring=!1;try{this.ensureInjectorInterval&&(clearInterval(this.ensureInjectorInterval),this.ensureInjectorInterval=null)}catch(t){this.log("error","Failed to clear injector interval:",t.message)}try{this.intelligenceListener&&(window.removeEventListener("message",this.intelligenceListener),this.intelligenceListener=null)}catch(t){this.log("error","Failed to remove intelligence listener:",t.message)}try{window.postMessage({type:"gurftron:control",action:"stop",pageToken:this.gurftronId},"*")}catch(t){this.log("error","Failed to signal gurftron.js to stop:",t.message)}this.log("info","Monitoring disabled")}markScanned(t,e,r=!1){try{const n=Date.now(),i=this.config.cacheDuration||36e5;this.scannedElements.set(t,{ts:n,key:e,hadThreat:r,ttl:i})}catch(t){this.log("error","markScanned failed:",t.message)}}shouldSkipScan(t){try{if(!t)return!1;const e=this.scannedElements.get(t);if(!e)return!1;const r=Date.now();return!e.hadThreat&&r-e.ts<(e.ttl||this.config.cacheDuration||36e5)}catch(t){return this.log("error","shouldSkipScan failed:",t.message),!1}}async fetchContent(t){try{const e=await fetch(t);if(e.ok)return await e.text();this.log("warn","Content fetch failed with status",e.status,"for",t)}catch(e){this.log("error","Content fetch error:",t,e.message)}return""}async handleUrlChange(t){try{if(t||(t=window.location.href),t===this.currentUrl)return;this.log("info","Detected URL change",this.currentUrl,"->",t),this.currentUrl=t,this.historyStack.push(t);try{this.scannedElements=new WeakMap}catch(t){this.scannedElements=new WeakMap}try{await this.fullScan()}catch(t){this.log("error","fullScan after URL change failed:",t&&t.message)}}catch(t){this.log("error","handleUrlChange failed:",t&&t.message)}}async detectPhishing(t,e=null,r=null){try{this.log("info","ðŸ” Starting phishing detection for:",t);const i=Date.now();let o=[],a=0,s=!1,c="safe",l=!1;const u=this.extractDomain(t);this.log("info",`ðŸŒ Extracted domain: ${u}`);const h=await this.getDomainInfo(u);this.log("info","ðŸ“Š Domain info retrieved:",h?"Yes":"No");const d=await this.checkGoogleSafeBrowsing(t);if(this.log("info","ðŸ›¡ï¸ Google Safe Browsing result: "+(d.isThreat?"THREAT":"Safe")),d.isThreat)return o.push({reason:d.details,source:"google_safe_browsing",score:1}),{url:t,domain:u,isPhishing:!0,confidence:1,severity:"critical",shouldBlock:!0,domainInfo:h,evidence:o,analysisTimeMs:Date.now()-i,method:"intelligent_phishing_detection"};o.push({reason:d.details,source:"google_safe_browsing",score:0});let f=null;if(h){const t=`Analyze this domain registration and hosting data for phishing risk. Return ONLY a valid JSON object with: {"isSuspicious": boolean, "confidence": number (0.0 to 1.0), "reasons": string[], "redFlags": string[]}. Domain: ${u}. Data: ${JSON.stringify(h,null,2)}`,e=await this.analyzeWithLLM(t,"domain_analysis",{passFullQuoted:!0});try{f=JSON.parse(e.details),f.isSuspicious&&(a=Math.max(a,f.confidence),o.push(...f.reasons.map(t=>({reason:t,source:"domain_llm_analysis",score:f.confidence}))))}catch(t){this.log("warn","Failed to parse domain LLM analysis:",t)}}let g=[];if(r&&e)if(this.log("info","ðŸ” Calling Brave Search for impersonation detection..."),g=await this.deepSearchForImpersonation(t,r,e,u),this.log("info",`ðŸ“Š Brave Search returned ${g.length} evidence items`),g.length>0){const t=Math.max(...g.map(t=>t.score));a=Math.max(a,t),o.push(...g),t>=.7&&(s=!0),this.log("warn",`âš ï¸ Brave Search found suspicious results! Max score: ${t.toFixed(2)}`)}else this.log("info","âœ… Brave Search found no suspicious results");else this.log("warn","âš ï¸ Skipping Brave Search - missing pageTitle or pageContent");const p=`You are a senior cybersecurity analyst. Your task: determine if this URL is a phishing site. Return ONLY a valid JSON object with: {"isPhishing": boolean, "confidence": number (0.0 to 1.0), "summary": string, "keyEvidence": string[], "recommendedAction": "block" | "warn" | "allow"}. CONTEXT: URL: ${t}, Domain: ${u}, Page Title: ${r||"N/A"}, Page Snippet: ${(null==e?void 0:e.substring(0,300))||"N/A"}, Domain Info: ${JSON.stringify(h||{},null,2)}, Search Evidence: ${JSON.stringify(g,null,2)}, Domain Risk Analysis: ${JSON.stringify(f||{},null,2)}`,y=await this.analyzeWithLLM(p,"phishing_reasoning",{passFullQuoted:!0});let m=null;try{m=JSON.parse(y.details),m.isPhishing&&(s=!0,a=Math.max(a,m.confidence),o.push(...(m.keyEvidence||[]).map(t=>({reason:`LLM: ${t}`,source:"llm_reasoning",score:m.confidence})))),"block"===m.recommendedAction&&m.confidence>=.8&&(l=!0)}catch(t){this.log("error","Failed to parse LLM reasoning result:",t),o.push({reason:"LLM analysis failed to parse",source:"llm_reasoning",score:0})}c=this.calculateSeverity({confidence:a}),l=l||s&&a>=.7;const v={url:t,domain:u,isPhishing:s,confidence:a,severity:c,shouldBlock:l,domainInfo:h,evidence:o,analysisTimeMs:Date.now()-i,method:"intelligent_phishing_detection"};if(this.log("warn",`ðŸš¨ Phishing Detection Complete: isPhishing=${s}, confidence=${a.toFixed(2)}, shouldBlock=${l}, evidence=${o.length} items`),s){this.log("error",`âš ï¸ PHISHING DETECTED! Domain: ${u}, Confidence: ${a.toFixed(2)}, Severity: ${c}`);const r=new URL(t,window.location.origin).href,i={id:await n(r),url:r,contentHash:e?await n(e):null,contentSummary:(null==e?void 0:e.substring(0,200))||"No content",threatResults:{...v,timestamp:Date.now()}};this.recordThreat(i)}else this.log("info",`âœ… No phishing detected for: ${u}`);return v}catch(e){return this.log("error","Intelligent phishing detection failed:",e),{url:t,isPhishing:!1,confidence:0,severity:"safe",shouldBlock:!1,domainInfo:null,evidence:[{reason:"Detection system failed internally.",source:"system_error",score:0}],analysisTimeMs:0,method:"intelligent_phishing_detection"}}}async checkGoogleSafeBrowsing(t){const e=await this.offloadApiCall("safebrowsing",{url:t,key:this.config.safeBrowsingKey});return null!=e&&e.matches&&e.matches.length>0?{isThreat:!0,details:`Flagged by Google Safe Browsing as ${e.matches[0].threatType}.`}:{isThreat:!1,details:"URL is not listed in Google Safe Browsing."}}async scanUrl(t,e={}){if(!t||"string"!=typeof t)return null;const r=new URL(t,window.location.origin).href,n=`url_${r}`,i=this.threatsCache.get(n);if(i&&Date.now()-i.timestamp<this.config.cacheDuration)return i.threat?i.threatJson:null;const o=[],a=await Promise.allSettled([this.checkPhishTank(r),this.checkOpenPhish(r),this.checkGoogleSafeBrowsing(r),this.checkUrlhaus(r),this.checkHybridAnalysis(r),this.checkUrlscan(r),this.extractIpAndCheckAbuse(r)]);o.push(`API check results: ${JSON.stringify(a.filter(t=>t.value).map(t=>t.reason))}`);const s=await this.checkResourceHeaders(r,"url");s&&o.push(`Header analysis: ${JSON.stringify(s)}`);const c=o.join("\n"),l=await this.analyzeWithLLM(c,"url_threats"),u=l.threat,h={threat:u,timestamp:Date.now()};if(this.threatsCache.set(n,h),this.metrics.scans++,this.updateMetrics(),u){const t=await this.createThreatJson(r,c,"url_threat",l.confidence>.7?"high":"medium",null,null,l.details);return h.threatJson=t,this.registerSignal("url_threat",r,l.confidence||1,l.details),t}return null}async getCachedData(t){const e=`feed_${t}`;let r=this.threatsCache.get(e);if(!r||Date.now()-r.timestamp>this.config.cacheDuration)try{r={data:await this.retryOp(()=>this.offloadApiCall(t,{})),timestamp:Date.now()},this.threatsCache.set(e,r)}catch(e){return this.log("error",`Feed load failed for ${t}:`,e.message),null}return r.data}async checkPhishTank(t){var e;const r=await this.getCachedData("phishtank");return null!=r&&null!==(e=r.urlSet)&&void 0!==e&&e.has(t)?"PhishTank positive":""}async checkOpenPhish(t){var e;const r=await this.getCachedData("openphish");return null!=r&&null!==(e=r.urls)&&void 0!==e&&e.includes(t)?"OpenPhish positive":""}async checkUrlhaus(t){var e;const r=await this.getCachedData("urlhaus");return null!=r&&null!==(e=r.urls)&&void 0!==e&&e.includes(t)?"URLhaus positive":""}async checkMalwareBazaar(t){var e;const r=await this.retryOp(()=>this.offloadApiCall("malwarebazaar",{hash:t}));return"ok"===(null==r?void 0:r.query_status)&&(null==r||null===(e=r.data)||void 0===e?void 0:e.length)>0?`MalwareBazaar hit: ${r.data.length}`:""}async checkHybridAnalysis(t){var e;const r=await this.retryOp(()=>this.offloadApiCall("hybridanalysis",{url:t}));return(null==r||null===(e=r.result)||void 0===e?void 0:e.length)>0?`HybridAnalysis results: ${r.result.length}`:""}async checkUrlscan(t){var e;const r=await this.retryOp(()=>this.offloadApiCall("urlscan",{url:t}));return(null==r||null===(e=r.results)||void 0===e?void 0:e.length)>0?`Urlscan results: ${r.results.length}`:""}async extractIpAndCheckAbuse(t){var e;const r=t.match(/(\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})/);if(!r||!this.config.abuseIPKey)return"";const n=r[0],i=await this.retryOp(()=>this.offloadApiCall("abuseipdb",{ip:n,key:this.config.abuseIPKey})),o=(null==i||null===(e=i.data)||void 0===e?void 0:e.abuseConfidenceScore)>50;return o&&this.config.abuseSubmissionOptIn&&await this.offloadApiCall("abuseipdb_submit",{ip:n,categories:"phishing"}),o?`AbuseIPDB score: ${i.data.abuseConfidenceScore}`:""}async scanForm(t){const e=t.innerHTML+t.textContent,r=[],n=t.querySelectorAll('input[type="hidden"], input[style*="display:none"], input[style*="visibility:hidden"]');r.push(`Hidden inputs count: ${n.length}; Names: ${Array.from(n).map(t=>t.name).join(", ")}`);const i=t.querySelectorAll('[style*="position:fixed"], [style*="z-index:9999"], iframe');r.push(`Overlays count: ${i.length}; X-Frame-Options present: ${!!document.querySelector('meta[http-equiv="X-Frame-Options"]')}`);const o="Detect phishing forms, credential harvesting, hidden fields, and overlay attacks: "+(r.join("\n")+`\nForm content: ${e}`),a=await this.analyzeWithLLM(o,"form_threats");if(a.threat){const e=a.confidence||.6;this.registerSignal("form_threat",t.action||this.currentUrl,e,a.details)}return null}async scanScript(t,e=null){var r,n,i;if(!t)return null;const o=[];o.push(`Script content length: ${t.length}; Entropy: ${this.calculateEntropy(t)}`),o.push("Contains eval or dynamic code: "+(/eval|Function|setTimeout|setInterval/i.test(t)?"Yes":"No")),o.push(`Event listeners: ${(null===(r=t.match(/addEventListener/g))||void 0===r?void 0:r.length)||0}`),o.push(`Network calls: ${(null===(n=t.match(/fetch|XMLHttpRequest|axios/i))||void 0===n?void 0:n.length)||0}`),o.push(`Storage access: ${(null===(i=t.match(/localStorage|sessionStorage|cookie/i))||void 0===i?void 0:i.length)||0}`);const a="Analyze script for malicious activity, obfuscation, eval usage, data exfiltration, wallet draining: "+(o.join("\n")+`\nFull content: ${t}`),s=await this.analyzeWithLLM(a,"script_threats");if(s.threat){const t=s.confidence||.7;this.registerSignal("script_threat",(null==e?void 0:e.src)||this.currentUrl,t,s.details)}return null}calculateEntropy(t){const e=t.length,r={};for(let n=0;n<e;n++){const e=t[n];r[e]=(r[e]||0)+1}let n=0;for(const t in r){const i=r[t]/e;n-=i*Math.log2(i)}return n}calculateSeverity(t){const e=t.confidence||t.score||0;return e>.9?"critical":e>.7?"high":e>.5?"medium":"low"}async scanCss(t,e=null){var r,n;if(!t)return null;const i=[];i.push(`CSS rules count: ${(null===(r=t.match(/{/g))||void 0===r?void 0:r.length)||0}`),i.push(`Position/visibility manipulations: ${(null===(n=t.match(/position|display|visibility|opacity|z-index/g))||void 0===n?void 0:n.length)||0}`);const o="Check for CSS-based attacks, keylogging styles, overlay manipulations, clickjacking: "+(i.join("\n")+`\nFull content: ${t}`),a=await this.analyzeWithLLM(o,"css_threats");return a.threat&&this.registerSignal("css_threat",(null==e?void 0:e.href)||this.currentUrl,a.confidence||.5,a.details),null}async scanDomText(){var t;const e=(null===(t=document.body)||void 0===t?void 0:t.textContent)||"",r=[];r.push(`Text length: ${e.length}`);const n="Analyze DOM text for phishing keywords, urgency tactics, credential requests: "+(r.join("\n")+`\nFull text: ${e.slice(0,4e3)}`),i=await this.analyzeWithLLM(n,"dom_threats");return i.threat&&this.registerSignal("dom_threat",this.currentUrl,i.confidence||.4,i.details),null}async detectCryptojacking(){const t=`Detect cryptojacking based on high CPU usage and resource consumption: CPU usage: ${await this.offloadScan("cpu_monitor",{duration:5e3})}%; Threshold: 80; Context: Background monitoring over 5s`,e=await this.analyzeWithLLM(t,"cryptojacking_threats");return e.threat&&this.registerSignal("cryptojacking",this.currentUrl,e.confidence||1,e.details),null}async detectTrackers(){this.log("info","Analyzing cookies and fingerprinting for trackers");const t=(document.cookie?document.cookie.split(";"):[]).filter(t=>{const e=t.split("=")[0].trim();return!e.includes(window.location.hostname)&&/tracker|analytics/i.test(e)&&t.includes("id=")});t.length>0&&this.log("info","Detected trackers in cookies:",t.map(t=>t.split("=")[0].trim()));const e=document.createElement("canvas"),r=e.getContext("2d");r.textBaseline="top",r.font="14px Arial",r.fillText("GurftronTest",2,2);const n=e.toDataURL(),i=`Third-party cookies: ${t.length}; Fingerprint data sample: ${n.slice(0,1e3)}`;this.log("info","Performing tracker heuristic scans (fingerprint/cookie analysis)");const o=`Detect third-party trackers, fingerprinting, analytics cookies, and surveillance patterns: ${i}`,a=await this.analyzeWithLLM(o,"tracker_threats");return a.threat&&(this.log("info","Detected TRACKER threat - registering signal for trackers"),this.registerSignal("trackers",this.currentUrl,a.confidence||.5,a.details)),null}async detectHijackingRedirections(){if(this.historyStack.length>3&&new Set(this.historyStack).size>2){const t=`History stack: ${this.historyStack.join(" -> ")}; Referrer: ${document.referrer}`,e=`Detect redirection chains, redirect hijacking, and suspicious URL changes: ${t}`,r=await this.analyzeWithLLM(e,"redirection_threats");if(r.threat){const e=await this.createThreatJson(this.currentUrl,t,"redirection_hijack","high",null,null,r.details);return this.recordThreat(e),e}}return null}async fullScan(){var t;this.log("info","Executing full page scan");const e=await this.checkThreatInDB(this.currentUrl);if(e){this.log("info","Threat report found in DB, skipping re-analysis:",e);try{e._registered=!0,await this.handleThreatFound(e)}catch(t){this.log("error","Failed to surface stored threat:",t.message)}return[e]}let r=[];const n=document.title,o=(null===(t=document.body)||void 0===t?void 0:t.textContent)||"",a=await this.detectPhishing(this.currentUrl,o,n);a.isPhishing&&r.push({type:"phishing",...a});const s=await this.scanUrl(this.currentUrl);s&&r.push(s);const c=await this.scanDomText();c&&r.push(c);const l=document.querySelectorAll(`script:not([data-gurftron="${this.gurftronId}"]), form, iframe, link[rel="stylesheet"], img, a, object, embed`);for(const t of l){let e,n="";"SCRIPT"===t.tagName?(this.log("info","Full-scan detected SCRIPT - scanning",t.src||"[inline]"),n=t.textContent||(t.src?await this.fetchContent(t.src):""),e=await this.scanScript(n,t)):"LINK"===t.tagName&&"stylesheet"===t.rel?(this.log("info","Full-scan detected LINK stylesheet - scanning",t.href),n=t.href?await this.fetchContent(t.href):"",e=await this.scanCss(n,t)):"FORM"===t.tagName?(this.log("info","Full-scan detected FORM - scanning form element"),e=await this.scanForm(t)):"IFRAME"===t.tagName?(this.log("info","Full-scan detected IFRAME - scanning",t.src),e=await this.scanUrl(t.src)):"IMG"===t.tagName?(this.log("info","Full-scan detected IMG - scanning",t.src),e=await this.scanImage(t.src,t)):"A"===t.tagName?(this.log("info","Full-scan detected LINK element - scanning",t.href),e=await this.scanLink(t.href,t)):"OBJECT"!==t.tagName&&"EMBED"!==t.tagName||(this.log("info","Full-scan detected OBJECT/EMBED - scanning",t.data||t.src),e=await this.scanFileResource(t.data||t.src,t)),e&&r.push(e)}window.gurftronDetector||(window.gurftronDetector=this);const u=await this.detectCryptojacking();u&&r.push(u);const h=await this.detectTrackers();h&&r.push(h);const d=await this.detectHijackingRedirections();d&&r.push(d);const f=r.filter(t=>t&&t.severity&&("high"===t.severity||"medium"===t.severity)).length/(r.length||1),g=f>=this.config.threatThreshold,p={url:this.currentUrl,time:(new Date).toISOString(),evidence:r,threatScore:f,isThreat:g,summary:g?"Threat detected based on aggregated evidence.":"No significant threat detected."};g&&(this.metrics.threatsDetected++,this.updateMetrics(),chrome.runtime.sendMessage({action:"threat_notify",type:"full_scan"}),this.log("warn","Threat detected in full scan:",JSON.stringify(p)));try{i({action:"update_metrics",metrics:this.metrics},t=>{t&&t.success?this.log("debug","Metrics updated in IndexedDB:",t.metrics):this.log("warn","Failed to update metrics:",null==t?void 0:t.error)})}catch(t){this.log("error","Failed to send metrics update:",t.message)}return[p]}async onDownloadScan(t,e){let r=[];const n=await this.scanUrl(t);if(n&&r.push(n),e){const n="computed_hash_if_accessible";if(await this.checkMalwareBazaar(n)){const i=await this.createThreatJson(t,"","file_malware","high",n,e);this.recordThreat(i),r.push(i)}}return r.length>0?(chrome.runtime.sendMessage({action:"threat_notify",type:"download"}),r):null}async scanImage(t,e=null){if(!t)return null;const r=[],n=await this.checkResourceHeaders(t,"image");r.push(`Headers: ${JSON.stringify(n)}`);const i=await this.offloadScan("image_stego_check",{url:t});r.push(`Stego analysis: ${JSON.stringify(i)}`);const o=r.join("\n"),a=`Detect steganography, tracking pixels, malicious metadata in images: ${o}`,s=await this.analyzeWithLLM(a,"image_threats");if(s.threat){const e=await this.createThreatJson(t,o,"image_threat","medium",null,null,s.details);return this.recordThreat(e),e}return null}async scanLink(t,e=null){if(!t)return null;const r=[],n=e&&("none"===e.style.display||"hidden"===e.style.visibility||"0"===e.style.opacity||0===e.offsetWidth);r.push("Visibility: "+(n?"Hidden (potential honeypot)":"Visible"));const i=await this.checkResourceHeaders(t,"link");r.push(`Headers: ${JSON.stringify(i)}`);const o=await this.offloadScan("link_snippet",{url:t});r.push(`Content snippet: ${o}`);const a=r.join("\n"),s=`Analyze link for phishing, typosquatting, malicious redirect, spoofed domains: ${a}`,c=await this.analyzeWithLLM(s,"link_threats",{passFullQuoted:!0});if(c.threat){const e=await this.createThreatJson(t,a,"link_threat","medium",null,null,c.details);return this.recordThreat(e),e}return null}async scanFileResource(t,e=null){if(!t)return null;const r=[],n=await this.checkResourceHeaders(t,"file");r.push(`Headers: ${JSON.stringify(n)}`);const i=r.join("\n"),o=`Analyze embedded file for malware, suspicious MIME types, executable content: ${i}`,a=await this.analyzeWithLLM(o,"file_threats");if(a.threat){const e=await this.createThreatJson(t,i,"file_threat","high",null,null,a.details);return this.recordThreat(e),e}return null}async checkResourceHeaders(t,e){const r=await this.offloadScan("resource_headers",{url:t});return r?{contentType:r["content-type"]||"",extension:t.split(".").pop().toLowerCase(),resourceType:e}:""}async createThreatJson(t,e,r,n,i=null,o=null,a=""){return{url:t,detectedContent:e.slice(0,500),time:(new Date).toISOString(),severity:n,fullContentHash:i,filePath:o,type:r,evidenceSummary:a}}async handleThreatFound(t){try{const e=new URL(this.currentUrl,window.location.origin).href;t.id=await n(e);try{const r=await this.checkThreatInDB(e);r&&r.id&&(t.alreadyRegistered=!0,t.id=r.id||t.id)}catch(t){console.warn("Pre-insert DB check failed:",t)}try{if(!t.userSummary){const e=t.evidenceSummary||t.detectedContent||"";if(e&&e.length>32){const r=await this.analyzeWithLLM(e,"user_summary");t.userSummary=r.details,t.confidence=r.confidence||t.confidence||0}else t.userSummary=e||"This page contains content that may try to steal data or run harmful code. We recommend leaving the site."}}catch(e){t.userSummary=t.evidenceSummary||t.detectedContent||"Potentially harmful content detected"}try{const e=Object.assign({},t,{page:this.currentUrl});try{i({action:"GURFTRON_WHOAMI"},t=>{try{t&&t.tabId&&(e.tabId=t.tabId)}catch(t){}chrome.storage.local.set({latestThreat:e},()=>{try{i({action:"open_results_tab"})}catch(t){try{console.warn("open_results_tab message failed")}catch(t){}}})})}catch(t){try{chrome.storage.local.set({latestThreat:e})}catch(t){}try{i({action:"open_results_tab"})}catch(t){try{console.warn("open_results_tab message failed")}catch(t){}}}}catch(t){this.log("error","Failed to persist/redirect to results page:",t&&t.message)}}catch(t){this.log("error","Failed to show threat modal:",t.message)}}recordThreat(t){this.threatsLog.push(t),this.metrics.threatsDetected++,this.updateMetrics(),chrome.storage.local.get("threatsLog",e=>{const r=e.threatsLog||[];r.push(t),r.length>500&&r.shift(),chrome.storage.local.set({threatsLog:r})}),this.log("warn","Threat detected:",JSON.stringify(t));try{i({action:"notify_threat",threat:t})}catch(t){}}registerSignal(t,e,r=.5,n=""){try{const i=Date.now(),o=`${t}::${e}`,a=this.signalStore.get(o)||[];a.push({score:r,source:t,details:n,ts:i});const s=this.signalTTL||6e4,c=a.filter(t=>i-t.ts<=s);this.signalStore.set(o,c),this.log("debug",`Signal registered for ${o}: count=${c.length} score=${r}`),this.handleAggregatedSignals(t,e,c)}catch(t){this.log("error","registerSignal failed:",t.message)}}async handleAggregatedSignals(t,e,r){try{if(!r||0===r.length)return;const n=r.reduce((t,e)=>t+(e.score||0),0)/r.length,i=Number(this.minSignals||1),o=.6;if(r.length>=i&&n>=o){this.log("warn",`Aggregated threat for ${e} (source ${t}): signals=${r.length}, avg=${n}`);const i=r.map(t=>({source:t.source,score:t.score,details:t.details}));this.log("debug","Triggered signals:",JSON.stringify(i));const o=r.map(t=>`${t.source}: ${t.details}`).join("\n").slice(0,1e3),a=`Triggered by ${r.length} signal(s): ${r.map(t=>t.source).join(", ")}. ${o.slice(0,200)}`,s={url:e,detectedContent:o.slice(0,500),time:(new Date).toISOString(),severity:n>.8?"high":"medium",fullContentHash:null,filePath:null,type:"aggregated_signal",evidenceSummary:`Aggregated ${r.length} signals, avg confidence ${n.toFixed(2)}`,triggeredSignals:i,userSummary:a};this.signalStore.delete(`${t}::${e}`),await this.handleThreatFound(s)}else this.log("debug",`Aggregation for ${e} not yet met: ${r.length} signals, avg=${n}`)}catch(t){this.log("error","handleAggregatedSignals failed:",t.message)}}dumpStatus(){try{const t={};for(const[e,r]of this.signalStore.entries())t[e]=r.map(t=>({score:t.score,details:t.details?t.details.slice(0,200):"",ts:t.ts}));console.groupCollapsed("Gurftron Status Dump"),console.log("Current URL:",this.currentUrl),console.log("Metrics:",this.metrics),console.log("Active monitors count:",this.monitors.size),console.log("Pending signals:",t),console.groupEnd()}catch(t){console.error("Failed to dump status:",t)}}}return window.addEventListener("message",async function(t){var e,r;if(t.source!==window)return;const n=(null===(e=t.data)||void 0===e?void 0:e.pageToken)||null;if(!(t.data&&t.data.type&&t.data.type.startsWith("starknet:"))||n&&n===window.gurftronPageId){if("starknet:injected:ready"===(null===(r=t.data)||void 0===r?void 0:r.type))return console.log("[Gurftron] Injected script is ready!"),void chrome.runtime.sendMessage({type:"content:pageLoaded"},function(t){var e,r;chrome.runtime.lastError&&console.warn("Error sending page load message:",chrome.runtime.lastError);try{var n;window.gurftronAccount=(null==t||null===(n=t.result)||void 0===n?void 0:n.wallet)||null}catch(t){window.gurftronAccount=null}if(!t||"content"!==t.to)return;const i=null==t||null===(e=t.result)||void 0===e?void 0:e.isLoggedIn,o=null==t||null===(r=t.result)||void 0===r?void 0:r.wallet;return!0!==i?(console.log("Gurftron: Not logged in, triggering wallet connection..."),void window.postMessage({type:"starknet:connect",payload:{account:o||null},pageToken:window.gurftronPageId||null},"*")):o&&"none"!==o?(console.log("Gurftron: Wallet found in storage:",o,"- proceeding with monitoring"),void(window.gurftronDetector&&"function"==typeof window.gurftronDetector.checkThreatInDB&&window.gurftronDetector.checkThreatInDB(window.location.href).then(async t=>{if(t)await window.gurftronDetector.handleThreatFound(t);else{window.gurftronDetector.startMonitoring();try{const t=await window.gurftronDetector.fullScan();t&&t.length>0&&t.some(t=>t.isThreat||t.isPhishing)&&console.log("Gurftron: Threat detected on initial scan")}catch(t){console.warn("Initial fullScan failed:",t)}}}).catch(t=>{console.warn("Error checking DB for threats:",t);try{window.gurftronDetector.startMonitoring(),window.gurftronDetector.fullScan().catch(t=>console.warn("fullScan failed:",t))}catch(t){console.warn("startMonitoring failed:",t)}}))):(console.log("Gurftron: No wallet found, triggering wallet connection..."),void window.postMessage({type:"starknet:connect",payload:{account:o||null},pageToken:window.gurftronPageId||null},"*"))});if(t.data&&t.data.type&&t.data.type.startsWith("starknet:")&&"starknet:threatAction"!==t.data.type){var o;const e=(null===(o=t.data)||void 0===o?void 0:o.response)??null;if(null!==e){const r=null==e?void 0:e.data;null!=r&&""!==r&&i({type:"processed:"+t.data.type.split(":")[1],payload:e},function(t){})}}}}),chrome.runtime.onMessage.addListener(function(t,e,r){try{if(t&&"CONTENT_SCRIPT_PING"===t.type)return r({ready:!0}),!1;if(t&&"download_scan"===t.action)return window.gurftronDetector&&"function"==typeof window.gurftronDetector.onDownloadScan?(window.gurftronDetector.onDownloadScan(t.url,t.filePath).then(t=>r(t)),!0):(r(null),!1);if(t&&"forward_block"===t.action){try{const e=t.payload&&t.payload.traceId;chrome.storage.local.get("blockTraces",r=>{const n=Array.isArray(r.blockTraces)?r.blockTraces:[];n.unshift({traceId:e||null,step:"content:forward_received",time:Date.now(),payloadMeta:{threatPresent:!(!t.payload||!t.payload.threat)}}),n.length>500&&(n.length=500),chrome.storage.local.set({blockTraces:n})})}catch(t){}return window.postMessage({type:"starknet:threatAction",action:"block",payload:t.payload,pageToken:window.gurftronPageId||null},"*"),r({ok:!0}),!0}if(t&&"starknet:connect"===t.type){window.postMessage({type:"starknet:getWalletStatus",pageToken:window.gurftronPageId||null},"*");const t=e=>{if(e.source===window&&e.data&&"starknet:getWalletStatus:response"===e.data.type){var n;window.removeEventListener("message",t);const i=(null===(n=e.data.response)||void 0===n?void 0:n.data)||{};r({connected:i.connected||!1,wallet:i.wallet||"none",network:i.network||null})}};return window.addEventListener("message",t),setTimeout(()=>{window.removeEventListener("message",t),r({connected:!1,wallet:"none"})},2e3),!0}if(t&&"starknet:verify"===t.type){window.postMessage({type:"starknet:verifyWallet",pageToken:window.gurftronPageId||null},"*");const t=e=>{if(e.source===window&&e.data&&"starknet:verifyWallet:response"===e.data.type){var n;window.removeEventListener("message",t);const i=(null===(n=e.data.response)||void 0===n?void 0:n.data)||{};r({connected:i.connected||!1,wallet:i.wallet||"none",verified:i.verified||!1})}};return window.addEventListener("message",t),setTimeout(()=>{window.removeEventListener("message",t),r({connected:!1,wallet:"none",verified:!1})},2e3),!0}if(t&&"STATE_UPDATE"===t.type){try{window.gurftronState=t.state||{},console.log("State updated in content script:",window.gurftronState)}catch(t){console.error("Error updating state:",t)}return!1}}catch(t){}return!1}),function(t){const e=window.location.hostname+window.location.pathname;i({type:"GURFTRON_GET_SECURE_ID",page:e},r=>{r&&r.secureId?t(r.secureId):t("gurftron_fallback_"+btoa(e))})}(function(t){window.gurftronPageId=t,function(){const t=document.createElement("script");t.src=chrome.runtime.getURL("gurftron.js");const e=`gurftron-extension-injected-${window.gurftronPageId||"unknown"}`;t.id=e;try{i({type:"GURFTRON_GET_INJECT_SIGNATURE",injectedId:e,secureId:window.gurftronPageId},e=>{try{e&&e.signature?(t.setAttribute("data-gurftron",window.gurftronPageId||"gurftron_unknown"),t.setAttribute("data-gurftron-sig",e.signature),t.setAttribute("data-gurftron-ts",e.ts)):t.setAttribute("data-gurftron",window.gurftronPageId||"gurftron_unknown")}catch(e){t.setAttribute("data-gurftron",window.gurftronPageId||"gurftron_unknown")}(document.head||document.documentElement).appendChild(t)})}catch(e){t.setAttribute("data-gurftron",window.gurftronPageId||"gurftron_unknown"),(document.head||document.documentElement).appendChild(t)}}(),window.gurftronDetector=new o({gurftronId:t})}),{}})());